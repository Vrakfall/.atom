"use strict";
var omnisharp_client_1 = require('../lib/omnisharp-client');
var _ = require('lodash');
var rxjs_1 = require('rxjs');
var vscode_languageserver_1 = require('vscode-languageserver');
var server_extended_1 = require('./server-extended');
var connection = vscode_languageserver_1.createConnection(new vscode_languageserver_1.StreamMessageReader(process.stdin), new vscode_languageserver_1.StreamMessageWriter(process.stdout));
var client;
var openEditors = new Set();
var ExcludeClassifications = [
    7 /* Number */,
    10 /* ExcludedCode */,
    2 /* Comment */,
    3 /* String */,
    5 /* Punctuation */,
    4 /* Operator */,
    6 /* Keyword */
];
// After the server has started the client sends an initilize request. The server receives
// in the passed params the rootPath of the workspace plus the client capabilites.
connection.onInitialize(function (params) {
    var enablePackageRestore = params.capabilities.enablePackageRestore === undefined || params.capabilities.enablePackageRestore;
    client = new omnisharp_client_1.ReactiveClient({
        projectPath: params.rootPath,
        runtime: omnisharp_client_1.Runtime.CoreClr,
        logger: {
            log: function (message) { connection.telemetry.logEvent({ type: 'log', message: message }); },
            error: function (message) { connection.telemetry.logEvent({ type: 'error', message: message }); }
        },
        serverOptions: {
            dotnet: { enablePackageRestore: enablePackageRestore }
        }
    });
    client.observe.diagnostic.subscribe(function (_a) {
        var Results = _a.Results;
        _.each(Results, function (result) {
            connection.sendDiagnostics({
                uri: toUri(result),
                diagnostics: _.map(result.QuickFixes, getDiagnostic)
            });
        });
    });
    if (params.capabilities.highlightProvider) {
        var highlightsContext_1 = new Map();
        client.observe.updatebuffer.subscribe(function (context) {
            if (openEditors.has(context.request.FileName)) {
                client.highlight({
                    FileName: context.request.FileName,
                    ExcludeClassifications: ExcludeClassifications
                });
            }
        });
        client.observe.close.subscribe(function (context) {
            if (highlightsContext_1.has(context.request.FileName)) {
                highlightsContext_1.delete(context.request.FileName);
            }
        });
        client.observe.highlight
            .bufferToggle(client.observe.highlight.throttleTime(100), function () { return rxjs_1.Observable.timer(100); })
            .concatMap(function (items) {
            var highlights = _(items)
                .reverse()
                .uniqBy(function (x) { return x.request.FileName; })
                .map(function (context) {
                if (!highlightsContext_1.has(context.request.FileName)) {
                    highlightsContext_1.set(context.request.FileName, []);
                }
                var newHighlights = getHighlights(context.response.Highlights);
                var currentHighlights = highlightsContext_1.get(context.request.FileName);
                var added = _.differenceBy(newHighlights, currentHighlights, function (x) { return x.id; });
                var removeHighlights = _.differenceBy(currentHighlights, newHighlights, function (x) { return x.id; });
                highlightsContext_1.set(context.request.FileName, newHighlights);
                return {
                    uri: toUri({ FileName: context.request.FileName }),
                    added: added,
                    removed: _.map(removeHighlights, function (x) { return x.id; })
                };
            })
                .value();
            return rxjs_1.Observable.from(highlights).concatMap(function (x) { return rxjs_1.Observable.of(x).delay(10); });
        })
            .subscribe(function (item) { return connection.sendNotification(server_extended_1.HighlightNotification.type, item); });
    }
    client.observe.events.subscribe(function (event) {
        connection.console.info(JSON.stringify(event));
    });
    client.observe.requests.subscribe(function (event) {
        connection.console.info(JSON.stringify(event));
    });
    client.observe.responses.subscribe(function (event) {
        connection.console.info(JSON.stringify(event));
    });
    /*
     * Little big of magic here
     * This will wait for the server to update all the buffers after a rename operation
     * And then update the diagnostics for all of the buffers.
     */
    client.observe.rename
        .mergeMap(function (rename) {
        return client.observe.updatebuffer
            .debounceTime(1000)
            .take(1)
            .mergeMap(function () {
            // TODO: Add a nicer way to queue many files here to omnisharp...
            return rxjs_1.Observable.merge.apply(rxjs_1.Observable, _.map(rename.response.Changes, function (item) { return client.diagnostics({ FileName: item.FileName }); }));
        });
    })
        .subscribe();
    client.connect();
    return client.state
        .filter(function (x) { return x === omnisharp_client_1.DriverState.Connected; })
        .take(1)
        .do(function () {
        // Kick code checking on.
        client.diagnostics({});
    })
        .map(function () { return ({
        capabilities: {
            //textDocumentSync: TextDocumentSyncKind.Full,
            // Not currently supported
            textDocumentSync: vscode_languageserver_1.TextDocumentSyncKind.Incremental,
            completionProvider: {},
            codeLensProvider: {
                resolveProvider: true
            },
            definitionProvider: true,
            documentFormattingProvider: true,
            documentOnTypeFormattingProvider: {
                firstTriggerCharacter: '}',
                moreTriggerCharacter: [';']
            },
            documentRangeFormattingProvider: true,
            //documentSymbolProvider: true,
            hoverProvider: true,
            referencesProvider: true,
            renameProvider: true,
            signatureHelpProvider: {
                triggerCharacters: ['(']
            },
            workspaceSymbolProvider: true,
            extended: {
                getCodeActionsProvider: true,
                runCodeActionProvider: true,
                implementationProvider: true,
                navigateProvider: true,
                highlightProvider: true
            }
        }
    }); })
        .toPromise();
});
connection.onExit(function () {
    client.disconnect();
});
/* not yet doing this... */
// connection.onDidChangeConfiguration((change) => {
// });
connection.onDidChangeWatchedFiles(function (change) {
    _.each(change.changes, function (change) {
        client.updatebuffer({
            FileName: fromUri(change),
            FromDisk: true
        });
    });
});
// ** Do we need this yet? **
// connection.onCompletionResolve((item: CompletionItem) => {
// });
connection.onDidChangeTextDocument(function (_a) {
    var textDocument = _a.textDocument, contentChanges = _a.contentChanges;
    // The editor itself might not support TextDocumentSyncKind.Incremental
    // So we check to see if we're getting ranges or not.
    if (contentChanges.length === 1 && !contentChanges[0].range) {
        // TextDocumentSyncKind.Full
        client.updatebuffer({
            FileName: fromUri(textDocument),
            Buffer: contentChanges[0].text
        });
    }
    else if (contentChanges.length > 0) {
        // TextDocumentSyncKind.Incremental
        var changes = _.map(contentChanges, function (change) {
            return ({
                NewText: change.text,
                FileName: fromUri(textDocument),
                StartColumn: change.range.start.character,
                StartLine: change.range.start.line,
                EndColumn: change.range.end.character,
                EndLine: change.range.end.line,
            });
        });
        client.updatebuffer({
            FileName: fromUri(textDocument),
            Changes: changes
        });
    }
});
connection.onDidOpenTextDocument(function (_a) {
    var textDocument = _a.textDocument;
    client.open({
        FileName: fromUri(textDocument)
    });
    client.updatebuffer({
        FileName: fromUri(textDocument),
        Buffer: textDocument.text
    });
    openEditors.add(fromUri(textDocument));
});
connection.onDidCloseTextDocument(function (_a) {
    var textDocument = _a.textDocument;
    client.close({
        FileName: fromUri(textDocument)
    });
    openEditors.delete(fromUri(textDocument));
});
connection.onDidSaveTextDocument(function (_a) {
    var textDocument = _a.textDocument;
    client.updatebuffer({
        FileName: fromUri(textDocument),
        FromDisk: true
    });
});
connection.onDefinition(function (_a) {
    var textDocument = _a.textDocument, position = _a.position;
    return client.gotodefinition({
        FileName: fromUri(textDocument),
        Column: position.character,
        Line: position.line
    })
        .map(getLocationPoint)
        .toPromise();
});
connection.onCompletion(function (_a) {
    var textDocument = _a.textDocument, position = _a.position;
    return client
        .autocomplete({
        FileName: fromUri(textDocument),
        Column: position.character,
        Line: position.line,
        WantDocumentationForEveryCompletionResult: true,
        WantKind: true,
        WantImportableTypes: true,
        WantMethodHeader: true,
        WantReturnType: true,
        WantSnippet: false,
        WordToComplete: ''
    }).map(function (x) { return _.map(x, function (value) {
        return {
            label: value.DisplayText,
            detail: value.Description,
            documentation: value.MethodHeader,
            filterText: value.CompletionText,
            kind: vscode_languageserver_1.CompletionItemKind[value.Kind],
            sortText: value.DisplayText
        };
    }); })
        .map(function (items) { return ({
        isIncomplete: false, items: items
    }); })
        .toPromise();
});
//connection.onCompletionResolve((x) => {});
connection.onHover(function (_a) {
    var textDocument = _a.textDocument, position = _a.position;
    return client.typelookup({
        FileName: fromUri(textDocument),
        Column: position.character,
        Line: position.line
    })
        .map(function (result) { return ({
        contents: (result.Type || '') + " " + (result.Documentation || ''),
    }); })
        .toPromise();
});
connection.onSignatureHelp(function (_a) {
    var textDocument = _a.textDocument, position = _a.position;
    return client.signatureHelp({
        FileName: fromUri(textDocument),
        Column: position.character,
        Line: position.line
    })
        .map(function (result) { return ({
        activeParameter: result.ActiveParameter,
        activeSignature: result.ActiveSignature,
        signatures: _.map(result.Signatures, function (z) { return ({
            documentation: z.Documentation,
            label: z.Label,
            parameters: _.map(z.Parameters, function (param) { return ({
                documentation: param.Documentation,
                label: param.Label,
            }); })
        }); })
    }); })
        .toPromise();
});
connection.onReferences(function (_a) {
    var context = _a.context, textDocument = _a.textDocument, position = _a.position;
    return client.findusages({
        FileName: fromUri(textDocument),
        Column: position.character,
        Line: position.line,
        ExcludeDefinition: !context.includeDeclaration
    })
        .map(function (result) { return _.map(result.QuickFixes, getLocation); })
        .toPromise();
});
//connection.onDocumentHighlight((x) => {});
//connection.onDocumentSymbol((x) => {});
connection.onWorkspaceSymbol(function (_a) {
    var query = _a.query;
    return client.findsymbols({ Filter: query })
        .map(function (results) { return _.map(results.QuickFixes, function (fix) { return ({
        kind: vscode_languageserver_1.SymbolKind[fix.Kind] || vscode_languageserver_1.SymbolKind.Variable,
        name: fix.Text,
        location: getLocation(fix)
    }); }); })
        .toPromise();
});
connection.onCodeLens(function (_a) {
    var textDocument = _a.textDocument;
    return client.currentfilemembersasflat({
        FileName: fromUri(textDocument)
    })
        .map(function (results) {
        return _.map(results, function (location) {
            return {
                data: _.defaults({ FileName: fromUri(textDocument) }, location),
                range: getRange(location)
            };
        });
    })
        .toPromise();
});
connection.onCodeLensResolve(function (codeLens) {
    return client.findusages(codeLens.data)
        .map(function (x) {
        codeLens.command = {
            // TODO: ...?
            title: "References (" + x.QuickFixes.length + ")",
            command: "references"
        };
        codeLens.data = {
            location: getLocation(codeLens.data)
        };
        return codeLens;
    })
        .toPromise();
});
// Requires new endpoint
connection.onDocumentFormatting(function (_a) {
    var textDocument = _a.textDocument, options = _a.options;
    return client.codeformat({
        WantsTextChanges: true,
        FileName: fromUri(textDocument),
    })
        .map(getTextEdits)
        .toPromise();
});
connection.onDocumentRangeFormatting(function (_a) {
    var textDocument = _a.textDocument, options = _a.options, range = _a.range;
    return client.formatRange({
        FileName: fromUri(textDocument),
        Column: range.start.character,
        Line: range.start.line,
        EndColumn: range.end.character,
        EndLine: range.end.line,
    })
        .map(getTextEdits)
        .toPromise();
});
connection.onDocumentOnTypeFormatting(function (_a) {
    var textDocument = _a.textDocument, options = _a.options, position = _a.position, ch = _a.ch;
    return client.formatAfterKeystroke({
        FileName: fromUri(textDocument),
        Character: ch,
        Line: position.line,
        Column: position.character
    })
        .map(getTextEdits)
        .toPromise();
});
connection.onRenameRequest(function (_a) {
    var textDocument = _a.textDocument, position = _a.position, newName = _a.newName;
    return client.rename({
        FileName: fromUri(textDocument),
        Line: position.line,
        Column: position.character,
        RenameTo: newName,
        ApplyTextChanges: false,
        WantsTextChanges: true
    })
        .map(toWorkspaceEdit)
        .toPromise();
});
/* EXTENDED ENDPOINTS */
connection.onRequest(server_extended_1.GetCodeActionsRequest.type, function (_a) {
    var textDocument = _a.textDocument, range = _a.range, context = _a.context;
    return client.getcodeactions({
        FileName: fromUri(textDocument),
        Selection: fromRange(range)
    })
        .map(function (item) {
        var codeActions = _.map(item.CodeActions, function (codeAction) {
            return {
                name: codeAction.Name,
                identifier: codeAction.Identifier
            };
        });
        return { codeActions: codeActions };
    })
        .toPromise();
});
connection.onRequest(server_extended_1.RunCodeActionRequest.type, function (_a) {
    var textDocument = _a.textDocument, range = _a.range, context = _a.context, identifier = _a.identifier;
    return client.runcodeaction({
        FileName: fromUri(textDocument),
        Selection: fromRange(range),
        Identifier: identifier,
        WantsTextChanges: true,
        ApplyTextChanges: false
    })
        .map(toWorkspaceEdit)
        .toPromise();
});
connection.onRequest(server_extended_1.ImplementationRequest.type, function (_a) {
    var textDocument = _a.textDocument, position = _a.position;
    return client.findimplementations({
        FileName: fromUri(textDocument),
        Column: position.character,
        Line: position.line
    })
        .map(function (z) { return z.QuickFixes; })
        .map(getLocationPoints)
        .toPromise();
});
connection.onRequest(server_extended_1.NavigateRequest.type, function (_a) {
    var textDocument = _a.textDocument, position = _a.position, direction = _a.direction;
    var request;
    if (direction === 'up') {
        request = client.navigateup({
            FileName: fromUri(textDocument),
            Column: position.character,
            Line: position.line
        });
    }
    else {
        request = client.navigatedown({
            FileName: fromUri(textDocument),
            Column: position.character,
            Line: position.line
        });
    }
    return request
        .map(getPosition)
        .toPromise();
});
// Listen on the connection
connection.listen();
function getRange(item) {
    return {
        start: {
            character: item.Column || item.StartColumn || 0,
            line: item.Line || item.StartLine || 0
        },
        end: {
            character: item.EndColumn,
            line: item.EndLine
        }
    };
}
function getHighlights(highlights) {
    return _.map(highlights, getHighlight);
}
function getHighlight(highlight) {
    var range = getRange(highlight);
    return {
        id: range.start.line + ":" + range.start.character + "|" + range.end.line + ":" + range.end.character + "|" + highlight.Kind,
        range: range,
        kind: highlight.Kind,
    };
}
function getLocationPoints(fix) {
    return _.map(fix, getLocationPoint);
}
function getLocationPoint(fix) {
    return getLocation(_.assign(fix, { EndColumn: fix.Column, EndLine: fix.Line }));
}
function getLocation(fix) {
    return {
        uri: toUri(fix),
        range: getRange(fix)
    };
}
function getPosition(model) {
    return vscode_languageserver_1.Position.create(model.Line, model.Column);
}
function getTextEdit(change) {
    return {
        range: getRange(change),
        newText: change.NewText,
    };
}
function getTextEdits(response) {
    return _.map(response.Changes, getTextEdit);
}
function getDiagnostic(item) {
    var sev = vscode_languageserver_1.DiagnosticSeverity.Error;
    if (item.LogLevel === 'Warning') {
        sev = vscode_languageserver_1.DiagnosticSeverity.Warning;
    }
    if (item.LogLevel === 'Hidden') {
        sev = vscode_languageserver_1.DiagnosticSeverity.Hint;
    }
    if (item.LogLevel === 'Information') {
        sev = vscode_languageserver_1.DiagnosticSeverity.Information;
    }
    return {
        severity: sev,
        message: item.Text,
        range: getRange(item)
    };
}
function fromUri(document) {
    return vscode_languageserver_1.Files.uriToFilePath(document.uri);
}
function fromRange(range) {
    return {
        Start: {
            Column: range.start.character,
            Line: range.start.line
        },
        End: {
            Column: range.end.character,
            Line: range.end.line
        }
    };
}
function toUri(result) {
    return toUriString(result.FileName);
}
function toWorkspaceEdit(item) {
    var changes = {};
    _.each(_.groupBy(item.Changes, function (x) { return x.FileName; }), function (result, key) {
        changes[toUriString(key)] = _.flatMap(result, function (item) {
            return _.map(item.Changes, getTextEdit);
        });
    });
    return { changes: changes };
}
// TODO: this code isn't perfect
function toUriString(path) {
    return "file://" + (process.platform === 'win32' ? '/' : '') + path.replace(':', encodeURIComponent(':'));
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxhbmd1YWdlc2VydmVyL3NlcnZlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaUNBQTZELHlCQUF5QixDQUFDLENBQUE7QUFDdkYsSUFBWSxDQUFDLFdBQU0sUUFBUSxDQUFDLENBQUE7QUFDNUIscUJBQTJCLE1BQU0sQ0FBQyxDQUFBO0FBRWxDLHNDQVVPLHVCQUF1QixDQUFDLENBQUE7QUFFL0IsZ0NBQXFSLG1CQUFtQixDQUFDLENBQUE7QUFFelMsSUFBSSxVQUFVLEdBQWdCLHdDQUFnQixDQUFDLElBQUksMkNBQW1CLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksMkNBQW1CLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDaEksSUFBSSxNQUFzQixDQUFDO0FBQzNCLElBQU0sV0FBVyxHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7QUFFdEMsSUFBTSxzQkFBc0IsR0FBRztJQUMzQixjQUFxQztJQUNyQyxxQkFBMkM7SUFDM0MsZUFBc0M7SUFDdEMsY0FBcUM7SUFDckMsbUJBQTBDO0lBQzFDLGdCQUF1QztJQUN2QyxlQUFzQztDQUN6QyxDQUFDO0FBRUYsMEZBQTBGO0FBQzFGLGtGQUFrRjtBQUNsRixVQUFVLENBQUMsWUFBWSxDQUFDLFVBQUMsTUFBTTtJQUMzQixJQUFNLG9CQUFvQixHQUF3QixNQUFNLENBQUMsWUFBYSxDQUFDLG9CQUFvQixLQUFLLFNBQVMsSUFBeUIsTUFBTSxDQUFDLFlBQWEsQ0FBQyxvQkFBb0IsQ0FBQztJQUU1SyxNQUFNLEdBQUcsSUFBSSxpQ0FBYyxDQUFDO1FBQ3hCLFdBQVcsRUFBRSxNQUFNLENBQUMsUUFBUTtRQUM1QixPQUFPLEVBQUUsMEJBQU8sQ0FBQyxPQUFPO1FBQ3hCLE1BQU0sRUFBRTtZQUNKLEdBQUcsRUFBRSxVQUFDLE9BQU8sSUFBTyxVQUFVLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsZ0JBQU8sRUFB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QUk7WUFDQSxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO0lBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDSCxNQUFNLENBQUMsRUFBRSxnQkFBTyxFQUFFLENBQUM7QUFDdkIsQ0FBQztBQUVELGdDQUFnQztBQUNoQyxxQkFBcUIsSUFBWTtJQUM3QixNQUFNLENBQUMsYUFBVSxPQUFPLENBQUMsUUFBUSxLQUFLLE9BQU8sR0FBRyxHQUFHLEdBQUcsRUFBRSxJQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFHLENBQUM7QUFDNUcsQ0FBQyIsImZpbGUiOiJsYW5ndWFnZXNlcnZlci9zZXJ2ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNb2RlbHMsIFJlYWN0aXZlQ2xpZW50LCBSdW50aW1lLCBEcml2ZXJTdGF0ZSB9IGZyb20gJy4uL2xpYi9vbW5pc2hhcnAtY2xpZW50JztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHtcbiAgICBTdHJlYW1NZXNzYWdlUmVhZGVyLCBTdHJlYW1NZXNzYWdlV3JpdGVyLFxuICAgIGNyZWF0ZUNvbm5lY3Rpb24sIElDb25uZWN0aW9uLCBUZXh0RG9jdW1lbnRTeW5jS2luZCxcbiAgICBUZXh0RG9jdW1lbnRzLCBUZXh0RG9jdW1lbnQsIERpYWdub3N0aWMsIERpYWdub3N0aWNTZXZlcml0eSxcbiAgICBJbml0aWFsaXplUGFyYW1zLCBJbml0aWFsaXplUmVzdWx0LCBUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyxcbiAgICBDb21wbGV0aW9uSXRlbSwgQ29tcGxldGlvbkl0ZW1LaW5kLCBDb2RlTGVucywgSG92ZXIsIExvY2F0aW9uLFxuICAgIENvbXBsZXRpb25MaXN0LFxuICAgIFNpZ25hdHVyZUhlbHAsIFNpZ25hdHVyZUluZm9ybWF0aW9uLCBQYXJhbWV0ZXJJbmZvcm1hdGlvbixcbiAgICBTeW1ib2xJbmZvcm1hdGlvbiwgU3ltYm9sS2luZCwgUmFuZ2UsIENvbW1hbmQsIFRleHRFZGl0LFxuICAgIE5vdGlmaWNhdGlvblR5cGUsIEZpbGVzLCBTZXJ2ZXJDYXBhYmlsaXRpZXMsIFBvc2l0aW9uXG59IGZyb20gJ3ZzY29kZS1sYW5ndWFnZXNlcnZlcic7XG5cbmltcG9ydCB7IEV4dGVuZGVkU2VydmVyQ2FwYWJpbGl0aWVzLCBDb2RlQWN0aW9uLCBDb2RlQWN0aW9uTGlzdCwgR2V0Q29kZUFjdGlvbnNQYXJhbXMsIEdldENvZGVBY3Rpb25zUmVxdWVzdCwgSGlnaGxpZ2h0LCBIaWdobGlnaHROb3RpZmljYXRpb24sIEltcGxlbWVudGF0aW9uUmVxdWVzdCwgTmF2aWdhdGVSZXF1ZXN0LCBSdW5Db2RlQWN0aW9uUGFyYW1zLCBSdW5Db2RlQWN0aW9uUmVxdWVzdCwgUHVibGlzaEhpZ2hsaWdodFBhcmFtcywgQ2xpZW50Q2FwYWJpbGl0aWVzIH0gZnJvbSAnLi9zZXJ2ZXItZXh0ZW5kZWQnO1xuXG5sZXQgY29ubmVjdGlvbjogSUNvbm5lY3Rpb24gPSBjcmVhdGVDb25uZWN0aW9uKG5ldyBTdHJlYW1NZXNzYWdlUmVhZGVyKHByb2Nlc3Muc3RkaW4pLCBuZXcgU3RyZWFtTWVzc2FnZVdyaXRlcihwcm9jZXNzLnN0ZG91dCkpO1xubGV0IGNsaWVudDogUmVhY3RpdmVDbGllbnQ7XG5jb25zdCBvcGVuRWRpdG9ycyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG5jb25zdCBFeGNsdWRlQ2xhc3NpZmljYXRpb25zID0gW1xuICAgIE1vZGVscy5IaWdobGlnaHRDbGFzc2lmaWNhdGlvbi5OdW1iZXIsXG4gICAgTW9kZWxzLkhpZ2hsaWdodENsYXNzaWZpY2F0aW9uLkV4Y2x1ZGVkQ29kZSxcbiAgICBNb2RlbHMuSGlnaGxpZ2h0Q2xhc3NpZmljYXRpb24uQ29tbWVudCxcbiAgICBNb2RlbHMuSGlnaGxpZ2h0Q2xhc3NpZmljYXRpb24uU3RyaW5nLFxuICAgIE1vZGVscy5IaWdobGlnaHRDbGFzc2lmaWNhdGlvbi5QdW5jdHVhdGlvbixcbiAgICBNb2RlbHMuSGlnaGxpZ2h0Q2xhc3NpZmljYXRpb24uT3BlcmF0b3IsXG4gICAgTW9kZWxzLkhpZ2hsaWdodENsYXNzaWZpY2F0aW9uLktleXdvcmRcbl07XG5cbi8vIEFmdGVyIHRoZSBzZXJ2ZXIgaGFzIHN0YXJ0ZWQgdGhlIGNsaWVudCBzZW5kcyBhbiBpbml0aWxpemUgcmVxdWVzdC4gVGhlIHNlcnZlciByZWNlaXZlc1xuLy8gaW4gdGhlIHBhc3NlZCBwYXJhbXMgdGhlIHJvb3RQYXRoIG9mIHRoZSB3b3Jrc3BhY2UgcGx1cyB0aGUgY2xpZW50IGNhcGFiaWxpdGVzLlxuY29ubmVjdGlvbi5vbkluaXRpYWxpemUoKHBhcmFtcykgPT4ge1xuICAgIGNvbnN0IGVuYWJsZVBhY2thZ2VSZXN0b3JlID0gKDxDbGllbnRDYXBhYmlsaXRpZXM+cGFyYW1zLmNhcGFiaWxpdGllcykuZW5hYmxlUGFja2FnZVJlc3RvcmUgPT09IHVuZGVmaW5lZCB8fCAoPENsaWVudENhcGFiaWxpdGllcz5wYXJhbXMuY2FwYWJpbGl0aWVzKS5lbmFibGVQYWNrYWdlUmVzdG9yZTtcblxuICAgIGNsaWVudCA9IG5ldyBSZWFjdGl2ZUNsaWVudCh7XG4gICAgICAgIHByb2plY3RQYXRoOiBwYXJhbXMucm9vdFBhdGgsXG4gICAgICAgIHJ1bnRpbWU6IFJ1bnRpbWUuQ29yZUNscixcbiAgICAgICAgbG9nZ2VyOiB7XG4gICAgICAgICAgICBsb2c6IChtZXNzYWdlKSA9PiB7IGNvbm5lY3Rpb24udGVsZW1ldHJ5LmxvZ0V2ZW50KHsgdHlwZTogJ2xvZycsIG1lc3NhZ2UgfSk7IH0sXG4gICAgICAgICAgICBlcnJvcjogKG1lc3NhZ2UpID0+IHsgY29ubmVjdGlvbi50ZWxlbWV0cnkubG9nRXZlbnQoeyB0eXBlOiAnZXJyb3InLCBtZXNzYWdlIH0pOyB9XG4gICAgICAgIH0sXG4gICAgICAgIHNlcnZlck9wdGlvbnM6IHtcbiAgICAgICAgICAgIGRvdG5ldDogeyBlbmFibGVQYWNrYWdlUmVzdG9yZSB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIGNsaWVudC5vYnNlcnZlLmRpYWdub3N0aWMuc3Vic2NyaWJlKCh7UmVzdWx0c30pID0+IHtcbiAgICAgICAgXy5lYWNoKFJlc3VsdHMsIHJlc3VsdCA9PiB7XG4gICAgICAgICAgICBjb25uZWN0aW9uLnNlbmREaWFnbm9zdGljcyh7XG4gICAgICAgICAgICAgICAgdXJpOiB0b1VyaShyZXN1bHQpLFxuICAgICAgICAgICAgICAgIGRpYWdub3N0aWNzOiBfLm1hcChyZXN1bHQuUXVpY2tGaXhlcywgZ2V0RGlhZ25vc3RpYylcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmICgoPENsaWVudENhcGFiaWxpdGllcz5wYXJhbXMuY2FwYWJpbGl0aWVzKS5oaWdobGlnaHRQcm92aWRlcikge1xuICAgICAgICBjb25zdCBoaWdobGlnaHRzQ29udGV4dCA9IG5ldyBNYXA8c3RyaW5nLCBIaWdobGlnaHRbXT4oKTtcblxuICAgICAgICBjbGllbnQub2JzZXJ2ZS51cGRhdGVidWZmZXIuc3Vic2NyaWJlKGNvbnRleHQgPT4ge1xuICAgICAgICAgICAgaWYgKG9wZW5FZGl0b3JzLmhhcyhjb250ZXh0LnJlcXVlc3QuRmlsZU5hbWUhKSkge1xuICAgICAgICAgICAgICAgIGNsaWVudC5oaWdobGlnaHQoe1xuICAgICAgICAgICAgICAgICAgICBGaWxlTmFtZTogY29udGV4dC5yZXF1ZXN0LkZpbGVOYW1lLFxuICAgICAgICAgICAgICAgICAgICBFeGNsdWRlQ2xhc3NpZmljYXRpb25zXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNsaWVudC5vYnNlcnZlLmNsb3NlLnN1YnNjcmliZShjb250ZXh0ID0+IHtcbiAgICAgICAgICAgIGlmIChoaWdobGlnaHRzQ29udGV4dC5oYXMoY29udGV4dC5yZXF1ZXN0LkZpbGVOYW1lISkpIHtcbiAgICAgICAgICAgICAgICBoaWdobGlnaHRzQ29udGV4dC5kZWxldGUoY29udGV4dC5yZXF1ZXN0LkZpbGVOYW1lISk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNsaWVudC5vYnNlcnZlLmhpZ2hsaWdodFxuICAgICAgICAgICAgLmJ1ZmZlclRvZ2dsZShjbGllbnQub2JzZXJ2ZS5oaWdobGlnaHQudGhyb3R0bGVUaW1lKDEwMCksICgpID0+IE9ic2VydmFibGUudGltZXIoMTAwKSlcbiAgICAgICAgICAgIC5jb25jYXRNYXAoKGl0ZW1zKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaGlnaGxpZ2h0cyA9IF8oaXRlbXMpXG4gICAgICAgICAgICAgICAgICAgIC5yZXZlcnNlKClcbiAgICAgICAgICAgICAgICAgICAgLnVuaXFCeSh4ID0+IHgucmVxdWVzdC5GaWxlTmFtZSEpXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoY29udGV4dCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhpZ2hsaWdodHNDb250ZXh0Lmhhcyhjb250ZXh0LnJlcXVlc3QuRmlsZU5hbWUhKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodHNDb250ZXh0LnNldChjb250ZXh0LnJlcXVlc3QuRmlsZU5hbWUhLCBbXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0hpZ2hsaWdodHMgPSBnZXRIaWdobGlnaHRzKGNvbnRleHQucmVzcG9uc2UuSGlnaGxpZ2h0cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50SGlnaGxpZ2h0cyA9IGhpZ2hsaWdodHNDb250ZXh0LmdldChjb250ZXh0LnJlcXVlc3QuRmlsZU5hbWUhKSAhO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWRkZWQgPSBfLmRpZmZlcmVuY2VCeShuZXdIaWdobGlnaHRzLCBjdXJyZW50SGlnaGxpZ2h0cywgeCA9PiB4LmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbW92ZUhpZ2hsaWdodHMgPSBfLmRpZmZlcmVuY2VCeShjdXJyZW50SGlnaGxpZ2h0cywgbmV3SGlnaGxpZ2h0cywgeCA9PiB4LmlkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0c0NvbnRleHQuc2V0KGNvbnRleHQucmVxdWVzdC5GaWxlTmFtZSEsIG5ld0hpZ2hsaWdodHMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVyaTogdG9VcmkoeyBGaWxlTmFtZTogY29udGV4dC5yZXF1ZXN0LkZpbGVOYW1lISB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVkOiBfLm1hcChyZW1vdmVIaWdobGlnaHRzLCB4ID0+IHguaWQpXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudmFsdWUoKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmZyb20oaGlnaGxpZ2h0cykuY29uY2F0TWFwKHggPT4gT2JzZXJ2YWJsZS5vZih4KS5kZWxheSgxMCkpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoaXRlbSA9PiBjb25uZWN0aW9uLnNlbmROb3RpZmljYXRpb24oSGlnaGxpZ2h0Tm90aWZpY2F0aW9uLnR5cGUsIGl0ZW0pKTtcbiAgICB9XG5cbiAgICBjbGllbnQub2JzZXJ2ZS5ldmVudHMuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgY29ubmVjdGlvbi5jb25zb2xlLmluZm8oSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTtcbiAgICB9KTtcblxuICAgIGNsaWVudC5vYnNlcnZlLnJlcXVlc3RzLnN1YnNjcmliZShldmVudCA9PiB7XG4gICAgICAgIGNvbm5lY3Rpb24uY29uc29sZS5pbmZvKEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7XG4gICAgfSk7XG5cbiAgICBjbGllbnQub2JzZXJ2ZS5yZXNwb25zZXMuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgY29ubmVjdGlvbi5jb25zb2xlLmluZm8oSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTtcbiAgICB9KTtcblxuICAgIC8qXG4gICAgICogTGl0dGxlIGJpZyBvZiBtYWdpYyBoZXJlXG4gICAgICogVGhpcyB3aWxsIHdhaXQgZm9yIHRoZSBzZXJ2ZXIgdG8gdXBkYXRlIGFsbCB0aGUgYnVmZmVycyBhZnRlciBhIHJlbmFtZSBvcGVyYXRpb25cbiAgICAgKiBBbmQgdGhlbiB1cGRhdGUgdGhlIGRpYWdub3N0aWNzIGZvciBhbGwgb2YgdGhlIGJ1ZmZlcnMuXG4gICAgICovXG4gICAgY2xpZW50Lm9ic2VydmUucmVuYW1lXG4gICAgICAgIC5tZXJnZU1hcChyZW5hbWUgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5vYnNlcnZlLnVwZGF0ZWJ1ZmZlclxuICAgICAgICAgICAgICAgIC5kZWJvdW5jZVRpbWUoMTAwMClcbiAgICAgICAgICAgICAgICAudGFrZSgxKVxuICAgICAgICAgICAgICAgIC5tZXJnZU1hcCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IEFkZCBhIG5pY2VyIHdheSB0byBxdWV1ZSBtYW55IGZpbGVzIGhlcmUgdG8gb21uaXNoYXJwLi4uXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKC4uLl8ubWFwKHJlbmFtZS5yZXNwb25zZS5DaGFuZ2VzLCBpdGVtID0+IGNsaWVudC5kaWFnbm9zdGljcyh7IEZpbGVOYW1lOiBpdGVtLkZpbGVOYW1lIH0pKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5zdWJzY3JpYmUoKTtcblxuICAgIGNsaWVudC5jb25uZWN0KCk7XG5cbiAgICByZXR1cm4gY2xpZW50LnN0YXRlXG4gICAgICAgIC5maWx0ZXIoeCA9PiB4ID09PSBEcml2ZXJTdGF0ZS5Db25uZWN0ZWQpXG4gICAgICAgIC50YWtlKDEpXG4gICAgICAgIC5kbygoKSA9PiB7XG4gICAgICAgICAgICAvLyBLaWNrIGNvZGUgY2hlY2tpbmcgb24uXG4gICAgICAgICAgICBjbGllbnQuZGlhZ25vc3RpY3Moe30pO1xuICAgICAgICB9KVxuICAgICAgICAubWFwKCgpID0+ICh7XG4gICAgICAgICAgICBjYXBhYmlsaXRpZXM6IDxFeHRlbmRlZFNlcnZlckNhcGFiaWxpdGllcyAmIFNlcnZlckNhcGFiaWxpdGllcz57XG4gICAgICAgICAgICAgICAgLy90ZXh0RG9jdW1lbnRTeW5jOiBUZXh0RG9jdW1lbnRTeW5jS2luZC5GdWxsLFxuICAgICAgICAgICAgICAgIC8vIE5vdCBjdXJyZW50bHkgc3VwcG9ydGVkXG4gICAgICAgICAgICAgICAgdGV4dERvY3VtZW50U3luYzogVGV4dERvY3VtZW50U3luY0tpbmQuSW5jcmVtZW50YWwsXG4gICAgICAgICAgICAgICAgY29tcGxldGlvblByb3ZpZGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vcmVzb2x2ZVByb3ZpZGVyOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb2RlTGVuc1Byb3ZpZGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmVQcm92aWRlcjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZGVmaW5pdGlvblByb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50Rm9ybWF0dGluZ1Byb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50T25UeXBlRm9ybWF0dGluZ1Byb3ZpZGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpcnN0VHJpZ2dlckNoYXJhY3RlcjogJ30nLFxuICAgICAgICAgICAgICAgICAgICBtb3JlVHJpZ2dlckNoYXJhY3RlcjogWyc7J11cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRvY3VtZW50UmFuZ2VGb3JtYXR0aW5nUHJvdmlkZXI6IHRydWUsXG4gICAgICAgICAgICAgICAgLy9kb2N1bWVudFN5bWJvbFByb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhvdmVyUHJvdmlkZXI6IHRydWUsXG4gICAgICAgICAgICAgICAgcmVmZXJlbmNlc1Byb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJlbmFtZVByb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNpZ25hdHVyZUhlbHBQcm92aWRlcjoge1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyQ2hhcmFjdGVyczogWycoJ11cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHdvcmtzcGFjZVN5bWJvbFByb3ZpZGVyOiB0cnVlLFxuICAgICAgICAgICAgICAgIGV4dGVuZGVkOiB7XG4gICAgICAgICAgICAgICAgICAgIGdldENvZGVBY3Rpb25zUHJvdmlkZXI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHJ1bkNvZGVBY3Rpb25Qcm92aWRlcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaW1wbGVtZW50YXRpb25Qcm92aWRlcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVQcm92aWRlcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0UHJvdmlkZXI6IHRydWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuY29ubmVjdGlvbi5vbkV4aXQoKCkgPT4ge1xuICAgIGNsaWVudC5kaXNjb25uZWN0KCk7XG59KTtcbi8qIG5vdCB5ZXQgZG9pbmcgdGhpcy4uLiAqL1xuLy8gY29ubmVjdGlvbi5vbkRpZENoYW5nZUNvbmZpZ3VyYXRpb24oKGNoYW5nZSkgPT4ge1xuLy8gfSk7XG5cbmNvbm5lY3Rpb24ub25EaWRDaGFuZ2VXYXRjaGVkRmlsZXMoKGNoYW5nZSkgPT4ge1xuICAgIF8uZWFjaChjaGFuZ2UuY2hhbmdlcywgY2hhbmdlID0+IHtcbiAgICAgICAgY2xpZW50LnVwZGF0ZWJ1ZmZlcih7XG4gICAgICAgICAgICBGaWxlTmFtZTogZnJvbVVyaShjaGFuZ2UpLFxuICAgICAgICAgICAgRnJvbURpc2s6IHRydWVcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuLy8gKiogRG8gd2UgbmVlZCB0aGlzIHlldD8gKipcbi8vIGNvbm5lY3Rpb24ub25Db21wbGV0aW9uUmVzb2x2ZSgoaXRlbTogQ29tcGxldGlvbkl0ZW0pID0+IHtcbi8vIH0pO1xuXG5jb25uZWN0aW9uLm9uRGlkQ2hhbmdlVGV4dERvY3VtZW50KCh7dGV4dERvY3VtZW50LCBjb250ZW50Q2hhbmdlc30pID0+IHtcbiAgICAvLyBUaGUgZWRpdG9yIGl0c2VsZiBtaWdodCBub3Qgc3VwcG9ydCBUZXh0RG9jdW1lbnRTeW5jS2luZC5JbmNyZW1lbnRhbFxuICAgIC8vIFNvIHdlIGNoZWNrIHRvIHNlZSBpZiB3ZSdyZSBnZXR0aW5nIHJhbmdlcyBvciBub3QuXG4gICAgaWYgKGNvbnRlbnRDaGFuZ2VzLmxlbmd0aCA9PT0gMSAmJiAhY29udGVudENoYW5nZXNbMF0ucmFuZ2UpIHtcbiAgICAgICAgLy8gVGV4dERvY3VtZW50U3luY0tpbmQuRnVsbFxuICAgICAgICBjbGllbnQudXBkYXRlYnVmZmVyKHtcbiAgICAgICAgICAgIEZpbGVOYW1lOiBmcm9tVXJpKHRleHREb2N1bWVudCksXG4gICAgICAgICAgICBCdWZmZXI6IGNvbnRlbnRDaGFuZ2VzWzBdLnRleHRcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChjb250ZW50Q2hhbmdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFRleHREb2N1bWVudFN5bmNLaW5kLkluY3JlbWVudGFsXG4gICAgICAgIGNvbnN0IGNoYW5nZXMgPSBfLm1hcChjb250ZW50Q2hhbmdlcywgY2hhbmdlID0+XG4gICAgICAgICAgICAoPE1vZGVscy5MaW5lUG9zaXRpb25TcGFuVGV4dENoYW5nZT57XG4gICAgICAgICAgICAgICAgTmV3VGV4dDogY2hhbmdlLnRleHQsXG4gICAgICAgICAgICAgICAgRmlsZU5hbWU6IGZyb21VcmkodGV4dERvY3VtZW50KSxcbiAgICAgICAgICAgICAgICBTdGFydENvbHVtbjogY2hhbmdlLnJhbmdlIS5zdGFydC5jaGFyYWN0ZXIsXG4gICAgICAgICAgICAgICAgU3RhcnRMaW5lOiBjaGFuZ2UucmFuZ2UhLnN0YXJ0LmxpbmUsXG4gICAgICAgICAgICAgICAgRW5kQ29sdW1uOiBjaGFuZ2UucmFuZ2UhLmVuZC5jaGFyYWN0ZXIsXG4gICAgICAgICAgICAgICAgRW5kTGluZTogY2hhbmdlLnJhbmdlIS5lbmQubGluZSxcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgY2xpZW50LnVwZGF0ZWJ1ZmZlcih7XG4gICAgICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICAgICAgQ2hhbmdlczogY2hhbmdlc1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuY29ubmVjdGlvbi5vbkRpZE9wZW5UZXh0RG9jdW1lbnQoKHt0ZXh0RG9jdW1lbnR9KSA9PiB7XG4gICAgY2xpZW50Lm9wZW4oe1xuICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpXG4gICAgfSk7XG4gICAgY2xpZW50LnVwZGF0ZWJ1ZmZlcih7XG4gICAgICAgIEZpbGVOYW1lOiBmcm9tVXJpKHRleHREb2N1bWVudCksXG4gICAgICAgIEJ1ZmZlcjogdGV4dERvY3VtZW50LnRleHRcbiAgICB9KTtcbiAgICBvcGVuRWRpdG9ycy5hZGQoZnJvbVVyaSh0ZXh0RG9jdW1lbnQpKTtcbn0pO1xuXG5jb25uZWN0aW9uLm9uRGlkQ2xvc2VUZXh0RG9jdW1lbnQoKHt0ZXh0RG9jdW1lbnR9KSA9PiB7XG4gICAgY2xpZW50LmNsb3NlKHtcbiAgICAgICAgRmlsZU5hbWU6IGZyb21VcmkodGV4dERvY3VtZW50KVxuICAgIH0pO1xuICAgIG9wZW5FZGl0b3JzLmRlbGV0ZShmcm9tVXJpKHRleHREb2N1bWVudCkpO1xufSk7XG5cbmNvbm5lY3Rpb24ub25EaWRTYXZlVGV4dERvY3VtZW50KCh7dGV4dERvY3VtZW50fSkgPT4ge1xuICAgIGNsaWVudC51cGRhdGVidWZmZXIoe1xuICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICBGcm9tRGlzazogdHJ1ZVxuICAgIH0pO1xufSk7XG5cbmNvbm5lY3Rpb24ub25EZWZpbml0aW9uKCh7dGV4dERvY3VtZW50LCBwb3NpdGlvbn0pID0+IHtcbiAgICByZXR1cm4gY2xpZW50LmdvdG9kZWZpbml0aW9uKHtcbiAgICAgICAgRmlsZU5hbWU6IGZyb21VcmkodGV4dERvY3VtZW50KSxcbiAgICAgICAgQ29sdW1uOiBwb3NpdGlvbi5jaGFyYWN0ZXIsXG4gICAgICAgIExpbmU6IHBvc2l0aW9uLmxpbmVcbiAgICB9KVxuICAgICAgICAubWFwKGdldExvY2F0aW9uUG9pbnQpXG4gICAgICAgIC50b1Byb21pc2UoKTtcbn0pO1xuXG5jb25uZWN0aW9uLm9uQ29tcGxldGlvbigoe3RleHREb2N1bWVudCwgcG9zaXRpb259OiBUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcykgPT4ge1xuICAgIHJldHVybiBjbGllbnRcbiAgICAgICAgLmF1dG9jb21wbGV0ZSh7XG4gICAgICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICAgICAgQ29sdW1uOiBwb3NpdGlvbi5jaGFyYWN0ZXIsXG4gICAgICAgICAgICBMaW5lOiBwb3NpdGlvbi5saW5lLFxuICAgICAgICAgICAgV2FudERvY3VtZW50YXRpb25Gb3JFdmVyeUNvbXBsZXRpb25SZXN1bHQ6IHRydWUsXG4gICAgICAgICAgICBXYW50S2luZDogdHJ1ZSxcbiAgICAgICAgICAgIFdhbnRJbXBvcnRhYmxlVHlwZXM6IHRydWUsXG4gICAgICAgICAgICBXYW50TWV0aG9kSGVhZGVyOiB0cnVlLFxuICAgICAgICAgICAgV2FudFJldHVyblR5cGU6IHRydWUsXG4gICAgICAgICAgICBXYW50U25pcHBldDogZmFsc2UsXG4gICAgICAgICAgICBXb3JkVG9Db21wbGV0ZTogJydcbiAgICAgICAgfSkubWFwKHggPT4gXy5tYXAoeCwgdmFsdWUgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIDxDb21wbGV0aW9uSXRlbT57XG4gICAgICAgICAgICAgICAgbGFiZWw6IHZhbHVlLkRpc3BsYXlUZXh0LFxuICAgICAgICAgICAgICAgIGRldGFpbDogdmFsdWUuRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgZG9jdW1lbnRhdGlvbjogdmFsdWUuTWV0aG9kSGVhZGVyLFxuICAgICAgICAgICAgICAgIGZpbHRlclRleHQ6IHZhbHVlLkNvbXBsZXRpb25UZXh0LFxuICAgICAgICAgICAgICAgIGtpbmQ6IDxhbnk+Q29tcGxldGlvbkl0ZW1LaW5kWzxhbnk+dmFsdWUuS2luZF0sXG4gICAgICAgICAgICAgICAgc29ydFRleHQ6IHZhbHVlLkRpc3BsYXlUZXh0XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSlcbiAgICAgICAgLm1hcChpdGVtcyA9PiAoPENvbXBsZXRpb25MaXN0PntcbiAgICAgICAgICAgIGlzSW5jb21wbGV0ZTogZmFsc2UsIGl0ZW1zXG4gICAgICAgIH0pKVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcbi8vY29ubmVjdGlvbi5vbkNvbXBsZXRpb25SZXNvbHZlKCh4KSA9PiB7fSk7XG5cbmNvbm5lY3Rpb24ub25Ib3Zlcigoe3RleHREb2N1bWVudCwgcG9zaXRpb259KSA9PiB7XG4gICAgcmV0dXJuIGNsaWVudC50eXBlbG9va3VwKHtcbiAgICAgICAgRmlsZU5hbWU6IGZyb21VcmkodGV4dERvY3VtZW50KSxcbiAgICAgICAgQ29sdW1uOiBwb3NpdGlvbi5jaGFyYWN0ZXIsXG4gICAgICAgIExpbmU6IHBvc2l0aW9uLmxpbmVcbiAgICB9KVxuICAgICAgICAubWFwKHJlc3VsdCA9PiAoPEhvdmVyPntcbiAgICAgICAgICAgIGNvbnRlbnRzOiBgJHtyZXN1bHQuVHlwZSB8fCAnJ30gJHtyZXN1bHQuRG9jdW1lbnRhdGlvbiB8fCAnJ31gLFxuICAgICAgICB9KSlcbiAgICAgICAgLnRvUHJvbWlzZSgpO1xufSk7XG5cbmNvbm5lY3Rpb24ub25TaWduYXR1cmVIZWxwKCh7dGV4dERvY3VtZW50LCBwb3NpdGlvbn0pID0+IHtcbiAgICByZXR1cm4gY2xpZW50LnNpZ25hdHVyZUhlbHAoe1xuICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICBDb2x1bW46IHBvc2l0aW9uLmNoYXJhY3RlcixcbiAgICAgICAgTGluZTogcG9zaXRpb24ubGluZVxuICAgIH0pXG4gICAgICAgIC5tYXAocmVzdWx0ID0+ICg8U2lnbmF0dXJlSGVscD57XG4gICAgICAgICAgICBhY3RpdmVQYXJhbWV0ZXI6IHJlc3VsdC5BY3RpdmVQYXJhbWV0ZXIsXG4gICAgICAgICAgICBhY3RpdmVTaWduYXR1cmU6IHJlc3VsdC5BY3RpdmVTaWduYXR1cmUsXG4gICAgICAgICAgICBzaWduYXR1cmVzOiBfLm1hcChyZXN1bHQuU2lnbmF0dXJlcywgeiA9PiAoPFNpZ25hdHVyZUluZm9ybWF0aW9uPntcbiAgICAgICAgICAgICAgICBkb2N1bWVudGF0aW9uOiB6LkRvY3VtZW50YXRpb24sXG4gICAgICAgICAgICAgICAgbGFiZWw6IHouTGFiZWwsXG4gICAgICAgICAgICAgICAgcGFyYW1ldGVyczogXy5tYXAoei5QYXJhbWV0ZXJzLCBwYXJhbSA9PiAoPFBhcmFtZXRlckluZm9ybWF0aW9uPntcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRhdGlvbjogcGFyYW0uRG9jdW1lbnRhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHBhcmFtLkxhYmVsLFxuICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH0pKVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuY29ubmVjdGlvbi5vblJlZmVyZW5jZXMoKHtjb250ZXh0LCB0ZXh0RG9jdW1lbnQsIHBvc2l0aW9ufSkgPT4ge1xuICAgIHJldHVybiBjbGllbnQuZmluZHVzYWdlcyh7XG4gICAgICAgIEZpbGVOYW1lOiBmcm9tVXJpKHRleHREb2N1bWVudCksXG4gICAgICAgIENvbHVtbjogcG9zaXRpb24uY2hhcmFjdGVyLFxuICAgICAgICBMaW5lOiBwb3NpdGlvbi5saW5lLFxuICAgICAgICBFeGNsdWRlRGVmaW5pdGlvbjogIWNvbnRleHQuaW5jbHVkZURlY2xhcmF0aW9uXG4gICAgfSlcbiAgICAgICAgLm1hcChyZXN1bHQgPT4gXy5tYXAoPE1vZGVscy5EaWFnbm9zdGljTG9jYXRpb25bXT5yZXN1bHQuUXVpY2tGaXhlcywgZ2V0TG9jYXRpb24pKVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuLy9jb25uZWN0aW9uLm9uRG9jdW1lbnRIaWdobGlnaHQoKHgpID0+IHt9KTtcbi8vY29ubmVjdGlvbi5vbkRvY3VtZW50U3ltYm9sKCh4KSA9PiB7fSk7XG5cbmNvbm5lY3Rpb24ub25Xb3Jrc3BhY2VTeW1ib2woKHtxdWVyeX0pID0+IHtcbiAgICByZXR1cm4gY2xpZW50LmZpbmRzeW1ib2xzKHsgRmlsdGVyOiBxdWVyeSB9KVxuICAgICAgICAubWFwKHJlc3VsdHMgPT4gXy5tYXAoPE1vZGVscy5TeW1ib2xMb2NhdGlvbltdPnJlc3VsdHMuUXVpY2tGaXhlcywgZml4ID0+ICg8U3ltYm9sSW5mb3JtYXRpb24+e1xuICAgICAgICAgICAga2luZDogPGFueT5TeW1ib2xLaW5kWzxhbnk+Zml4LktpbmRdIHx8IFN5bWJvbEtpbmQuVmFyaWFibGUsXG4gICAgICAgICAgICBuYW1lOiBmaXguVGV4dCxcbiAgICAgICAgICAgIGxvY2F0aW9uOiBnZXRMb2NhdGlvbihmaXgpXG4gICAgICAgIH0pKSlcbiAgICAgICAgLnRvUHJvbWlzZSgpO1xufSk7XG5cbmNvbm5lY3Rpb24ub25Db2RlTGVucygoe3RleHREb2N1bWVudH0pID0+IHtcbiAgICByZXR1cm4gY2xpZW50LmN1cnJlbnRmaWxlbWVtYmVyc2FzZmxhdCh7XG4gICAgICAgIEZpbGVOYW1lOiBmcm9tVXJpKHRleHREb2N1bWVudClcbiAgICB9KVxuICAgICAgICAubWFwKHJlc3VsdHMgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIF8ubWFwKHJlc3VsdHMsIGxvY2F0aW9uID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gPENvZGVMZW5zPntcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogXy5kZWZhdWx0cyh7IEZpbGVOYW1lOiBmcm9tVXJpKHRleHREb2N1bWVudCkgfSwgbG9jYXRpb24pLFxuICAgICAgICAgICAgICAgICAgICByYW5nZTogZ2V0UmFuZ2UobG9jYXRpb24pXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuY29ubmVjdGlvbi5vbkNvZGVMZW5zUmVzb2x2ZSgoY29kZUxlbnMpID0+IHtcbiAgICByZXR1cm4gY2xpZW50LmZpbmR1c2FnZXMoY29kZUxlbnMuZGF0YSlcbiAgICAgICAgLm1hcCh4ID0+IHtcbiAgICAgICAgICAgIGNvZGVMZW5zLmNvbW1hbmQgPSB7XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogLi4uP1xuICAgICAgICAgICAgICAgIHRpdGxlOiBgUmVmZXJlbmNlcyAoJHt4LlF1aWNrRml4ZXMubGVuZ3RofSlgLFxuICAgICAgICAgICAgICAgIGNvbW1hbmQ6IGByZWZlcmVuY2VzYFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29kZUxlbnMuZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBsb2NhdGlvbjogZ2V0TG9jYXRpb24oY29kZUxlbnMuZGF0YSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gY29kZUxlbnM7XG4gICAgICAgIH0pXG4gICAgICAgIC50b1Byb21pc2UoKTtcbn0pO1xuXG4vLyBSZXF1aXJlcyBuZXcgZW5kcG9pbnRcbmNvbm5lY3Rpb24ub25Eb2N1bWVudEZvcm1hdHRpbmcoKHt0ZXh0RG9jdW1lbnQsIG9wdGlvbnN9KSA9PiB7XG4gICAgcmV0dXJuIGNsaWVudC5jb2RlZm9ybWF0KHtcbiAgICAgICAgV2FudHNUZXh0Q2hhbmdlczogdHJ1ZSxcbiAgICAgICAgRmlsZU5hbWU6IGZyb21VcmkodGV4dERvY3VtZW50KSxcbiAgICB9KVxuICAgICAgICAubWFwKGdldFRleHRFZGl0cylcbiAgICAgICAgLnRvUHJvbWlzZSgpO1xufSk7XG5cbmNvbm5lY3Rpb24ub25Eb2N1bWVudFJhbmdlRm9ybWF0dGluZygoe3RleHREb2N1bWVudCwgb3B0aW9ucywgcmFuZ2V9KSA9PiB7XG4gICAgcmV0dXJuIGNsaWVudC5mb3JtYXRSYW5nZSh7XG4gICAgICAgIEZpbGVOYW1lOiBmcm9tVXJpKHRleHREb2N1bWVudCksXG4gICAgICAgIENvbHVtbjogcmFuZ2Uuc3RhcnQuY2hhcmFjdGVyLFxuICAgICAgICBMaW5lOiByYW5nZS5zdGFydC5saW5lLFxuICAgICAgICBFbmRDb2x1bW46IHJhbmdlLmVuZC5jaGFyYWN0ZXIsXG4gICAgICAgIEVuZExpbmU6IHJhbmdlLmVuZC5saW5lLFxuICAgIH0pXG4gICAgICAgIC5tYXAoZ2V0VGV4dEVkaXRzKVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuY29ubmVjdGlvbi5vbkRvY3VtZW50T25UeXBlRm9ybWF0dGluZygoe3RleHREb2N1bWVudCwgb3B0aW9ucywgcG9zaXRpb24sIGNofSkgPT4ge1xuICAgIHJldHVybiBjbGllbnQuZm9ybWF0QWZ0ZXJLZXlzdHJva2Uoe1xuICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICBDaGFyYWN0ZXI6IGNoLFxuICAgICAgICBMaW5lOiBwb3NpdGlvbi5saW5lLFxuICAgICAgICBDb2x1bW46IHBvc2l0aW9uLmNoYXJhY3RlclxuICAgIH0pXG4gICAgICAgIC5tYXAoZ2V0VGV4dEVkaXRzKVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuY29ubmVjdGlvbi5vblJlbmFtZVJlcXVlc3QoKHt0ZXh0RG9jdW1lbnQsIHBvc2l0aW9uLCBuZXdOYW1lfSkgPT4ge1xuICAgIHJldHVybiBjbGllbnQucmVuYW1lKHtcbiAgICAgICAgRmlsZU5hbWU6IGZyb21VcmkodGV4dERvY3VtZW50KSxcbiAgICAgICAgTGluZTogcG9zaXRpb24ubGluZSxcbiAgICAgICAgQ29sdW1uOiBwb3NpdGlvbi5jaGFyYWN0ZXIsXG4gICAgICAgIFJlbmFtZVRvOiBuZXdOYW1lLFxuICAgICAgICBBcHBseVRleHRDaGFuZ2VzOiBmYWxzZSxcbiAgICAgICAgV2FudHNUZXh0Q2hhbmdlczogdHJ1ZVxuICAgIH0pXG4gICAgICAgIC5tYXAodG9Xb3Jrc3BhY2VFZGl0KVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuLyogRVhURU5ERUQgRU5EUE9JTlRTICovXG5jb25uZWN0aW9uLm9uUmVxdWVzdChHZXRDb2RlQWN0aW9uc1JlcXVlc3QudHlwZSwgKHt0ZXh0RG9jdW1lbnQsIHJhbmdlLCBjb250ZXh0fSkgPT4ge1xuICAgIHJldHVybiBjbGllbnQuZ2V0Y29kZWFjdGlvbnMoe1xuICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICBTZWxlY3Rpb246IGZyb21SYW5nZShyYW5nZSlcbiAgICB9KVxuICAgICAgICAubWFwKGl0ZW0gPT4ge1xuICAgICAgICAgICAgY29uc3QgY29kZUFjdGlvbnMgPSBfLm1hcChpdGVtLkNvZGVBY3Rpb25zLCBjb2RlQWN0aW9uID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBjb2RlQWN0aW9uLk5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGlkZW50aWZpZXI6IGNvZGVBY3Rpb24uSWRlbnRpZmllclxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHsgY29kZUFjdGlvbnMgfTtcbiAgICAgICAgfSlcbiAgICAgICAgLnRvUHJvbWlzZSgpO1xufSk7XG5cbmNvbm5lY3Rpb24ub25SZXF1ZXN0KFJ1bkNvZGVBY3Rpb25SZXF1ZXN0LnR5cGUsICh7dGV4dERvY3VtZW50LCByYW5nZSwgY29udGV4dCwgaWRlbnRpZmllcn0pID0+IHtcbiAgICByZXR1cm4gY2xpZW50LnJ1bmNvZGVhY3Rpb24oe1xuICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICBTZWxlY3Rpb246IGZyb21SYW5nZShyYW5nZSksXG4gICAgICAgIElkZW50aWZpZXI6IGlkZW50aWZpZXIsXG4gICAgICAgIFdhbnRzVGV4dENoYW5nZXM6IHRydWUsXG4gICAgICAgIEFwcGx5VGV4dENoYW5nZXM6IGZhbHNlXG4gICAgfSlcbiAgICAgICAgLm1hcCh0b1dvcmtzcGFjZUVkaXQpXG4gICAgICAgIC50b1Byb21pc2UoKTtcbn0pO1xuXG5jb25uZWN0aW9uLm9uUmVxdWVzdChJbXBsZW1lbnRhdGlvblJlcXVlc3QudHlwZSwgKHt0ZXh0RG9jdW1lbnQsIHBvc2l0aW9ufSkgPT4ge1xuICAgIHJldHVybiBjbGllbnQuZmluZGltcGxlbWVudGF0aW9ucyh7XG4gICAgICAgIEZpbGVOYW1lOiBmcm9tVXJpKHRleHREb2N1bWVudCksXG4gICAgICAgIENvbHVtbjogcG9zaXRpb24uY2hhcmFjdGVyLFxuICAgICAgICBMaW5lOiBwb3NpdGlvbi5saW5lXG4gICAgfSlcbiAgICAgICAgLm1hcCh6ID0+IHouUXVpY2tGaXhlcylcbiAgICAgICAgLm1hcChnZXRMb2NhdGlvblBvaW50cylcbiAgICAgICAgLnRvUHJvbWlzZSgpO1xufSk7XG5cbmNvbm5lY3Rpb24ub25SZXF1ZXN0KE5hdmlnYXRlUmVxdWVzdC50eXBlLCAoe3RleHREb2N1bWVudCwgcG9zaXRpb24sIGRpcmVjdGlvbn0pID0+IHtcbiAgICBsZXQgcmVxdWVzdDogT2JzZXJ2YWJsZTxNb2RlbHMuTmF2aWdhdGVSZXNwb25zZT47XG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3VwJykge1xuICAgICAgICByZXF1ZXN0ID0gY2xpZW50Lm5hdmlnYXRldXAoe1xuICAgICAgICAgICAgRmlsZU5hbWU6IGZyb21VcmkodGV4dERvY3VtZW50KSxcbiAgICAgICAgICAgIENvbHVtbjogcG9zaXRpb24uY2hhcmFjdGVyLFxuICAgICAgICAgICAgTGluZTogcG9zaXRpb24ubGluZVxuICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXF1ZXN0ID0gY2xpZW50Lm5hdmlnYXRlZG93bih7XG4gICAgICAgICAgICBGaWxlTmFtZTogZnJvbVVyaSh0ZXh0RG9jdW1lbnQpLFxuICAgICAgICAgICAgQ29sdW1uOiBwb3NpdGlvbi5jaGFyYWN0ZXIsXG4gICAgICAgICAgICBMaW5lOiBwb3NpdGlvbi5saW5lXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVxdWVzdFxuICAgICAgICAubWFwKGdldFBvc2l0aW9uKVxuICAgICAgICAudG9Qcm9taXNlKCk7XG59KTtcblxuLy8gTGlzdGVuIG9uIHRoZSBjb25uZWN0aW9uXG5jb25uZWN0aW9uLmxpc3RlbigpO1xuXG5mdW5jdGlvbiBnZXRSYW5nZShpdGVtOiB7IFN0YXJ0Q29sdW1uOiBudW1iZXI7IFN0YXJ0TGluZTogbnVtYmVyOyBFbmRDb2x1bW46IG51bWJlcjsgRW5kTGluZTogbnVtYmVyOyB9KTogUmFuZ2U7XG5mdW5jdGlvbiBnZXRSYW5nZShpdGVtOiB7IENvbHVtbjogbnVtYmVyOyBMaW5lOiBudW1iZXI7IEVuZENvbHVtbjogbnVtYmVyOyBFbmRMaW5lOiBudW1iZXI7IH0pOiBSYW5nZTtcbmZ1bmN0aW9uIGdldFJhbmdlKGl0ZW06IHsgQ29sdW1uPzogbnVtYmVyOyBMaW5lPzogbnVtYmVyOyBTdGFydENvbHVtbj86IG51bWJlcjsgU3RhcnRMaW5lPzogbnVtYmVyOyBFbmRDb2x1bW46IG51bWJlcjsgRW5kTGluZTogbnVtYmVyOyB9KSB7XG4gICAgcmV0dXJuIDxSYW5nZT57XG4gICAgICAgIHN0YXJ0OiB7XG4gICAgICAgICAgICBjaGFyYWN0ZXI6IGl0ZW0uQ29sdW1uIHx8IGl0ZW0uU3RhcnRDb2x1bW4gfHwgMCxcbiAgICAgICAgICAgIGxpbmU6IGl0ZW0uTGluZSB8fCBpdGVtLlN0YXJ0TGluZSB8fCAwXG4gICAgICAgIH0sXG4gICAgICAgIGVuZDoge1xuICAgICAgICAgICAgY2hhcmFjdGVyOiBpdGVtLkVuZENvbHVtbixcbiAgICAgICAgICAgIGxpbmU6IGl0ZW0uRW5kTGluZVxuICAgICAgICB9XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0SGlnaGxpZ2h0cyhoaWdobGlnaHRzOiBNb2RlbHMuSGlnaGxpZ2h0U3BhbltdKSB7XG4gICAgcmV0dXJuIF8ubWFwKGhpZ2hsaWdodHMsIGdldEhpZ2hsaWdodCk7XG59XG5cbmZ1bmN0aW9uIGdldEhpZ2hsaWdodChoaWdobGlnaHQ6IE1vZGVscy5IaWdobGlnaHRTcGFuKSB7XG4gICAgY29uc3QgcmFuZ2UgPSBnZXRSYW5nZShoaWdobGlnaHQpO1xuICAgIHJldHVybiA8SGlnaGxpZ2h0PntcbiAgICAgICAgaWQ6IGAke3JhbmdlLnN0YXJ0LmxpbmV9OiR7cmFuZ2Uuc3RhcnQuY2hhcmFjdGVyfXwke3JhbmdlLmVuZC5saW5lfToke3JhbmdlLmVuZC5jaGFyYWN0ZXJ9fCR7aGlnaGxpZ2h0LktpbmR9YCxcbiAgICAgICAgcmFuZ2U6IHJhbmdlLFxuICAgICAgICBraW5kOiBoaWdobGlnaHQuS2luZCxcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBnZXRMb2NhdGlvblBvaW50cyhmaXg6IHsgQ29sdW1uOiBudW1iZXI7IExpbmU6IG51bWJlcjsgRmlsZU5hbWU6IHN0cmluZzsgfVtdKSB7XG4gICAgcmV0dXJuIF8ubWFwKGZpeCwgZ2V0TG9jYXRpb25Qb2ludCk7XG59XG5cbmZ1bmN0aW9uIGdldExvY2F0aW9uUG9pbnQoZml4OiB7IENvbHVtbjogbnVtYmVyOyBMaW5lOiBudW1iZXI7IEZpbGVOYW1lOiBzdHJpbmc7IH0pIHtcbiAgICByZXR1cm4gZ2V0TG9jYXRpb24oXy5hc3NpZ24oZml4LCB7IEVuZENvbHVtbjogZml4LkNvbHVtbiwgRW5kTGluZTogZml4LkxpbmUgfSkpO1xufVxuXG5mdW5jdGlvbiBnZXRMb2NhdGlvbihmaXg6IHsgQ29sdW1uOiBudW1iZXI7IExpbmU6IG51bWJlcjsgRW5kQ29sdW1uOiBudW1iZXI7IEVuZExpbmU6IG51bWJlcjsgRmlsZU5hbWU6IHN0cmluZzsgfSkge1xuICAgIHJldHVybiA8TG9jYXRpb24+e1xuICAgICAgICB1cmk6IHRvVXJpKGZpeCksXG4gICAgICAgIHJhbmdlOiBnZXRSYW5nZShmaXgpXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gZ2V0UG9zaXRpb24obW9kZWw6IE1vZGVscy5OYXZpZ2F0ZVJlc3BvbnNlKSB7XG4gICAgcmV0dXJuIFBvc2l0aW9uLmNyZWF0ZShtb2RlbC5MaW5lLCBtb2RlbC5Db2x1bW4pXG59XG5cbmZ1bmN0aW9uIGdldFRleHRFZGl0KGNoYW5nZTogTW9kZWxzLkxpbmVQb3NpdGlvblNwYW5UZXh0Q2hhbmdlKSB7XG4gICAgcmV0dXJuIDxUZXh0RWRpdD57XG4gICAgICAgIHJhbmdlOiBnZXRSYW5nZShjaGFuZ2UpLFxuICAgICAgICBuZXdUZXh0OiBjaGFuZ2UuTmV3VGV4dCxcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBnZXRUZXh0RWRpdHMocmVzcG9uc2U6IHsgQ2hhbmdlczogTW9kZWxzLkxpbmVQb3NpdGlvblNwYW5UZXh0Q2hhbmdlW10gfSkge1xuICAgIHJldHVybiBfLm1hcChyZXNwb25zZS5DaGFuZ2VzLCBnZXRUZXh0RWRpdCk7XG59XG5cbmZ1bmN0aW9uIGdldERpYWdub3N0aWMoaXRlbTogTW9kZWxzLkRpYWdub3N0aWNMb2NhdGlvbikge1xuICAgIGxldCBzZXYgPSBEaWFnbm9zdGljU2V2ZXJpdHkuRXJyb3I7XG4gICAgaWYgKGl0ZW0uTG9nTGV2ZWwgPT09ICdXYXJuaW5nJykge1xuICAgICAgICBzZXYgPSBEaWFnbm9zdGljU2V2ZXJpdHkuV2FybmluZztcbiAgICB9XG4gICAgaWYgKGl0ZW0uTG9nTGV2ZWwgPT09ICdIaWRkZW4nKSB7XG4gICAgICAgIHNldiA9IERpYWdub3N0aWNTZXZlcml0eS5IaW50O1xuICAgIH1cbiAgICBpZiAoaXRlbS5Mb2dMZXZlbCA9PT0gJ0luZm9ybWF0aW9uJykge1xuICAgICAgICBzZXYgPSBEaWFnbm9zdGljU2V2ZXJpdHkuSW5mb3JtYXRpb247XG4gICAgfVxuXG4gICAgcmV0dXJuIDxEaWFnbm9zdGljPntcbiAgICAgICAgc2V2ZXJpdHk6IHNldixcbiAgICAgICAgbWVzc2FnZTogaXRlbS5UZXh0LFxuICAgICAgICByYW5nZTogZ2V0UmFuZ2UoaXRlbSlcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBmcm9tVXJpKGRvY3VtZW50OiB7IHVyaTogc3RyaW5nOyB9KSB7XG4gICAgcmV0dXJuIEZpbGVzLnVyaVRvRmlsZVBhdGgoZG9jdW1lbnQudXJpKTtcbn1cblxuZnVuY3Rpb24gZnJvbVJhbmdlKHJhbmdlOiBSYW5nZSk6IE1vZGVscy5WMi5SYW5nZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgU3RhcnQ6IHtcbiAgICAgICAgICAgIENvbHVtbjogcmFuZ2Uuc3RhcnQuY2hhcmFjdGVyLFxuICAgICAgICAgICAgTGluZTogcmFuZ2Uuc3RhcnQubGluZVxuICAgICAgICB9LFxuICAgICAgICBFbmQ6IHtcbiAgICAgICAgICAgIENvbHVtbjogcmFuZ2UuZW5kLmNoYXJhY3RlcixcbiAgICAgICAgICAgIExpbmU6IHJhbmdlLmVuZC5saW5lXG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiB0b1VyaShyZXN1bHQ6IHsgRmlsZU5hbWU6IHN0cmluZzsgfSkge1xuICAgIHJldHVybiB0b1VyaVN0cmluZyhyZXN1bHQuRmlsZU5hbWUpO1xufVxuXG5mdW5jdGlvbiB0b1dvcmtzcGFjZUVkaXQoaXRlbTogeyBDaGFuZ2VzOiBNb2RlbHMuTW9kaWZpZWRGaWxlUmVzcG9uc2VbXSB9KSB7XG4gICAgY29uc3QgY2hhbmdlczogeyBbdXJpOiBzdHJpbmddOiBUZXh0RWRpdFtdOyB9ID0ge307XG4gICAgXy5lYWNoKF8uZ3JvdXBCeShpdGVtLkNoYW5nZXMsIHggPT4geC5GaWxlTmFtZSksIChyZXN1bHQsIGtleSkgPT4ge1xuICAgICAgICBjaGFuZ2VzW3RvVXJpU3RyaW5nKGtleSldID0gXy5mbGF0TWFwKFxuICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8ubWFwKGl0ZW0uQ2hhbmdlcywgZ2V0VGV4dEVkaXQpO1xuICAgICAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHsgY2hhbmdlcyB9O1xufVxuXG4vLyBUT0RPOiB0aGlzIGNvZGUgaXNuJ3QgcGVyZmVjdFxuZnVuY3Rpb24gdG9VcmlTdHJpbmcocGF0aDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIGBmaWxlOi8vJHtwcm9jZXNzLnBsYXRmb3JtID09PSAnd2luMzInID8gJy8nIDogJyd9JHtwYXRoLnJlcGxhY2UoJzonLCBlbmNvZGVVUklDb21wb25lbnQoJzonKSl9YDtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
