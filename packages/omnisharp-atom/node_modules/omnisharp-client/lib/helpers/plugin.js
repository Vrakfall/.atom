"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.getPluginPath = getPluginPath;

var _rxjs = require("rxjs");

var _fs = require("fs");

var fs = _interopRequireWildcard(_fs);

var _child_process = require("child_process");

var _path = require("path");

var _create = require("../operators/create");

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

var bootstrappedPlugins = new Map();
var exists = _rxjs.Observable.bindCallback(fs.exists),
    readFile = _rxjs.Observable.bindNodeCallback(fs.readFile);
var md5 = require("md5");
function getPluginPath(solutionLocation, ctx, requestedPlugins, logger) {
    var plugins = [];
    var hashStrings = [];
    var hash = void 0;
    requestedPlugins.forEach(function (plugin) {
        plugins.push(plugin);
    });
    return (0, _create.createObservable)(function (observer) {
        logger.log("Bootstrapping " + solutionLocation);
        exists((0, _path.join)(solutionLocation, "omnisharp.json")).filter(function (x) {
            return !!x;
        }).flatMap(function (x) {
            return readFile((0, _path.join)(solutionLocation, "omnisharp.json"));
        }).map(function (x) {
            return JSON.parse(x.toString());
        }).do({
            next: function next(obj) {
                if (obj.plugins) {
                    hashStrings.push(obj.plugins);
                }
            },
            complete: function complete() {
                hash = md5(JSON.stringify(plugins.concat(hashStrings)));
                if (bootstrappedPlugins.has(hash)) {
                    observer.next(bootstrappedPlugins.get(hash));
                    observer.complete();
                    return;
                }
                var command = [ctx.location, "-s", solutionLocation].concat(plugins.map(function (x) {
                    if (x.location) {
                        return "--plugins " + x.location;
                    } else if (x.version) {
                        return "--plugin-name " + x.name + "@" + x.version;
                    } else {
                        return "--plugin-name " + x.name;
                    }
                })).join(" ");
                (0, _child_process.exec)(command, function (error, stdout) {
                    if (error) {
                        observer.error(error);
                        return;
                    }
                    var location = stdout.toString().trim();
                    if (location) {
                        return;
                    }
                    observer.next(ctx.location);
                    observer.complete();
                });
            }
        });
    }).map(function (path) {
        return path && path || ctx.location;
    }).do(function (result) {
        if (!bootstrappedPlugins.has(hash)) bootstrappedPlugins.set(hash, result);
        logger.log("Finished bootstrapping " + solutionLocation);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9oZWxwZXJzL3BsdWdpbi50cyIsImxpYi9oZWxwZXJzL3BsdWdpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztRQWFBOztBQ2JBOztBQUNBOztJREFZOztBQ0NaOztBQUNBOztBQUNBOzs7O0FESUEsSUFBTSxzQkFBc0IsSUFBSSxHQUFKLEVBQXRCO0FBQ04sSUFBTSxTQUFTLGlCQUFXLFlBQVgsQ0FBd0IsR0FBRyxNQUFILENBQWpDO0lBQ0YsV0FBOEMsaUJBQVcsZ0JBQVgsQ0FBNEIsR0FBRyxRQUFILENBQTFFO0FBQ0osSUFBTSxNQUE4QixRQUFRLEtBQVIsQ0FBOUI7QUFFTixTQUFBLGFBQUEsQ0FBOEIsZ0JBQTlCLEVBQXdELEdBQXhELEVBQTZFLGdCQUE3RSxFQUFtSCxNQUFuSCxFQUFrSTtBQUM5SCxRQUFNLFVBQWlCLEVBQWpCLENBRHdIO0FBRTlILFFBQU0sY0FBcUIsRUFBckIsQ0FGd0g7QUFHOUgsUUFBSSxhQUFKLENBSDhIO0FBSTlILHFCQUFpQixPQUFqQixDQUF5QixrQkFBTTtBQUMzQixnQkFBUSxJQUFSLENBQWEsTUFBYixFQUQyQjtLQUFOLENBQXpCLENBSjhIO0FBUTlILFdBQU8sOEJBQXlCLG9CQUFRO0FBQ3BDLGVBQU8sR0FBUCxDQUFXLG1CQUFtQixnQkFBbkIsQ0FBWCxDQURvQztBQUdwQyxlQUFPLGdCQUFLLGdCQUFMLEVBQXVCLGdCQUF2QixDQUFQLEVBQ0ssTUFETCxDQUNZO21CQUFLLENBQUMsQ0FBQyxDQUFEO1NBQU4sQ0FEWixDQUVLLE9BRkwsQ0FFYTttQkFBSyxTQUFTLGdCQUFLLGdCQUFMLEVBQXVCLGdCQUF2QixDQUFUO1NBQUwsQ0FGYixDQUdLLEdBSEwsQ0FHUzttQkFBSyxLQUFLLEtBQUwsQ0FBVyxFQUFFLFFBQUYsRUFBWDtTQUFMLENBSFQsQ0FJSyxFQUpMLENBSVE7QUFDQSxrQkFBTSxtQkFBRztBQUNMLG9CQUFJLElBQUksT0FBSixFQUFhO0FBQUUsZ0NBQVksSUFBWixDQUFpQixJQUFJLE9BQUosQ0FBakIsQ0FBRjtpQkFBakI7YUFERTtBQUdOLHNCQUFVLG9CQUFBO0FBQ04sdUJBQU8sSUFBSSxLQUFLLFNBQUwsQ0FBZSxRQUFRLE1BQVIsQ0FBZSxXQUFmLENBQWYsQ0FBSixDQUFQLENBRE07QUFHTixvQkFBSSxvQkFBb0IsR0FBcEIsQ0FBd0IsSUFBeEIsQ0FBSixFQUFtQztBQUMvQiw2QkFBUyxJQUFULENBQWMsb0JBQW9CLEdBQXBCLENBQXdCLElBQXhCLENBQWQsRUFEK0I7QUFFL0IsNkJBQVMsUUFBVCxHQUYrQjtBQUcvQiwyQkFIK0I7aUJBQW5DO0FBTUEsb0JBQU0sVUFBVSxDQUFDLElBQUksUUFBSixFQUFjLElBQWYsRUFBcUIsZ0JBQXJCLEVBQXVDLE1BQXZDLENBQ1osUUFBUSxHQUFSLENBQVksYUFBQztBQUNULHdCQUFJLEVBQUUsUUFBRixFQUFZO0FBQ1osOENBQW9CLEVBQUUsUUFBRixDQURSO3FCQUFoQixNQUVPLElBQUksRUFBRSxPQUFGLEVBQVc7QUFDbEIsa0RBQXdCLEVBQUUsSUFBRixTQUFVLEVBQUUsT0FBRixDQURoQjtxQkFBZixNQUVBO0FBQ0gsa0RBQXdCLEVBQUUsSUFBRixDQURyQjtxQkFGQTtpQkFIQyxDQURBLEVBU1IsSUFUUSxDQVNILEdBVEcsQ0FBVixDQVRBO0FBb0JOLHlDQUFLLE9BQUwsRUFBYyxVQUFTLEtBQVQsRUFBZ0IsTUFBaEIsRUFBc0I7QUFDaEMsd0JBQUksS0FBSixFQUFXO0FBQ1AsaUNBQVMsS0FBVCxDQUFlLEtBQWYsRUFETztBQUVQLCtCQUZPO3FCQUFYO0FBSUEsd0JBQU0sV0FBVyxPQUFPLFFBQVAsR0FBa0IsSUFBbEIsRUFBWCxDQUwwQjtBQU1oQyx3QkFBSSxRQUFKLEVBQWtDO0FBRTlCLCtCQUY4QjtxQkFBbEM7QUFJQSw2QkFBUyxJQUFULENBQWMsSUFBSSxRQUFKLENBQWQsQ0FWZ0M7QUFXaEMsNkJBQVMsUUFBVCxHQVhnQztpQkFBdEIsQ0FBZCxDQXBCTTthQUFBO1NBUmxCLEVBSG9DO0tBQVIsQ0FBekIsQ0ErQ0YsR0EvQ0UsQ0ErQ0U7ZUFBUSxRQUFRLElBQVIsSUFBZ0IsSUFBSSxRQUFKO0tBQXhCLENBL0NGLENBZ0RGLEVBaERFLENBZ0RDLGtCQUFNO0FBQ04sWUFBSSxDQUFDLG9CQUFvQixHQUFwQixDQUF3QixJQUF4QixDQUFELEVBQ0Esb0JBQW9CLEdBQXBCLENBQXdCLElBQXhCLEVBQThCLE1BQTlCLEVBREo7QUFFQSxlQUFPLEdBQVAsQ0FBVyw0QkFBNEIsZ0JBQTVCLENBQVgsQ0FITTtLQUFOLENBaERSLENBUjhIO0NBQWxJIiwiZmlsZSI6ImxpYi9oZWxwZXJzL3BsdWdpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHtleGVjfSBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiO1xuaW1wb3J0IHtSdW50aW1lQ29udGV4dH0gZnJvbSBcIi4vcnVudGltZVwiO1xuaW1wb3J0IHtqb2lufSBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHtJT21uaXNoYXJwUGx1Z2luLCBJTG9nZ2VyfSBmcm9tIFwiLi4vZW51bXNcIjtcbmltcG9ydCB7Y3JlYXRlT2JzZXJ2YWJsZX0gZnJvbSBcIi4uL29wZXJhdG9ycy9jcmVhdGVcIjtcblxuY29uc3QgYm9vdHN0cmFwcGVkUGx1Z2lucyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG5jb25zdCBleGlzdHMgPSBPYnNlcnZhYmxlLmJpbmRDYWxsYmFjayhmcy5leGlzdHMpLFxuICAgIHJlYWRGaWxlOiAoZmlsZTogc3RyaW5nKSA9PiBPYnNlcnZhYmxlPGFueT4gPSBPYnNlcnZhYmxlLmJpbmROb2RlQ2FsbGJhY2soZnMucmVhZEZpbGUpO1xuY29uc3QgbWQ1OiAodmFsdWU6IGFueSkgPT4gc3RyaW5nID0gcmVxdWlyZShcIm1kNVwiKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFBsdWdpblBhdGgoc29sdXRpb25Mb2NhdGlvbjogc3RyaW5nLCBjdHg6IFJ1bnRpbWVDb250ZXh0LCByZXF1ZXN0ZWRQbHVnaW5zOiBJT21uaXNoYXJwUGx1Z2luW10sIGxvZ2dlcjogSUxvZ2dlcikge1xuICAgIGNvbnN0IHBsdWdpbnM6IGFueVtdID0gW107XG4gICAgY29uc3QgaGFzaFN0cmluZ3M6IGFueVtdID0gW107XG4gICAgbGV0IGhhc2g6IHN0cmluZztcbiAgICByZXF1ZXN0ZWRQbHVnaW5zLmZvckVhY2gocGx1Z2luID0+IHtcbiAgICAgICAgcGx1Z2lucy5wdXNoKHBsdWdpbik7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY3JlYXRlT2JzZXJ2YWJsZTxzdHJpbmc+KG9ic2VydmVyID0+IHtcbiAgICAgICAgbG9nZ2VyLmxvZyhcIkJvb3RzdHJhcHBpbmcgXCIgKyBzb2x1dGlvbkxvY2F0aW9uKTtcbiAgICAgICAgLy8gSW5jbHVkZSB0aGUgcGx1Z2lucyBkZWZpbmVkIGluIG9tbmlzaGFycC5qc29uLCB0aGV5IGNvdWxkIGhhdmUgY2hhbmdlZC5cbiAgICAgICAgZXhpc3RzKGpvaW4oc29sdXRpb25Mb2NhdGlvbiwgXCJvbW5pc2hhcnAuanNvblwiKSlcbiAgICAgICAgICAgIC5maWx0ZXIoeCA9PiAhIXgpXG4gICAgICAgICAgICAuZmxhdE1hcCh4ID0+IHJlYWRGaWxlKGpvaW4oc29sdXRpb25Mb2NhdGlvbiwgXCJvbW5pc2hhcnAuanNvblwiKSkpXG4gICAgICAgICAgICAubWFwKHggPT4gSlNPTi5wYXJzZSh4LnRvU3RyaW5nKCkpKVxuICAgICAgICAgICAgLmRvKHtcbiAgICAgICAgICAgICAgICBuZXh0OiBvYmogPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLnBsdWdpbnMpIHsgaGFzaFN0cmluZ3MucHVzaChvYmoucGx1Z2lucyk7IH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGhhc2ggPSBtZDUoSlNPTi5zdHJpbmdpZnkocGx1Z2lucy5jb25jYXQoaGFzaFN0cmluZ3MpKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGJvb3RzdHJhcHBlZFBsdWdpbnMuaGFzKGhhc2gpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KGJvb3RzdHJhcHBlZFBsdWdpbnMuZ2V0KGhhc2gpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kID0gW2N0eC5sb2NhdGlvbiwgXCItc1wiLCBzb2x1dGlvbkxvY2F0aW9uXS5jb25jYXQoXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW5zLm1hcCh4ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeC5sb2NhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYC0tcGx1Z2lucyAke3gubG9jYXRpb259YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHgudmVyc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYC0tcGx1Z2luLW5hbWUgJHt4Lm5hbWV9QCR7eC52ZXJzaW9ufWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAtLXBsdWdpbi1uYW1lICR7eC5uYW1lfWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpLmpvaW4oXCIgXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGV4ZWMoY29tbWFuZCwgZnVuY3Rpb24oZXJyb3IsIHN0ZG91dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gc3Rkb3V0LnRvU3RyaW5nKCkudHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uKSAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXN0b3JlKGxvY2F0aW9uLCBjdHgsIGxvZ2dlcikuc3Vic2NyaWJlKG9ic2VydmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KGN0eC5sb2NhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9KVxuICAgICAgICAubWFwKHBhdGggPT4gcGF0aCAmJiBwYXRoIHx8IGN0eC5sb2NhdGlvbilcbiAgICAgICAgLmRvKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICBpZiAoIWJvb3RzdHJhcHBlZFBsdWdpbnMuaGFzKGhhc2gpKVxuICAgICAgICAgICAgICAgIGJvb3RzdHJhcHBlZFBsdWdpbnMuc2V0KGhhc2gsIHJlc3VsdCk7XG4gICAgICAgICAgICBsb2dnZXIubG9nKFwiRmluaXNoZWQgYm9vdHN0cmFwcGluZyBcIiArIHNvbHV0aW9uTG9jYXRpb24pO1xuICAgICAgICB9KTtcbn1cbiIsImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSBcImNoaWxkX3Byb2Nlc3NcIjtcbmltcG9ydCB7IGpvaW4gfSBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHsgY3JlYXRlT2JzZXJ2YWJsZSB9IGZyb20gXCIuLi9vcGVyYXRvcnMvY3JlYXRlXCI7XG5jb25zdCBib290c3RyYXBwZWRQbHVnaW5zID0gbmV3IE1hcCgpO1xuY29uc3QgZXhpc3RzID0gT2JzZXJ2YWJsZS5iaW5kQ2FsbGJhY2soZnMuZXhpc3RzKSwgcmVhZEZpbGUgPSBPYnNlcnZhYmxlLmJpbmROb2RlQ2FsbGJhY2soZnMucmVhZEZpbGUpO1xuY29uc3QgbWQ1ID0gcmVxdWlyZShcIm1kNVwiKTtcbmV4cG9ydCBmdW5jdGlvbiBnZXRQbHVnaW5QYXRoKHNvbHV0aW9uTG9jYXRpb24sIGN0eCwgcmVxdWVzdGVkUGx1Z2lucywgbG9nZ2VyKSB7XG4gICAgY29uc3QgcGx1Z2lucyA9IFtdO1xuICAgIGNvbnN0IGhhc2hTdHJpbmdzID0gW107XG4gICAgbGV0IGhhc2g7XG4gICAgcmVxdWVzdGVkUGx1Z2lucy5mb3JFYWNoKHBsdWdpbiA9PiB7XG4gICAgICAgIHBsdWdpbnMucHVzaChwbHVnaW4pO1xuICAgIH0pO1xuICAgIHJldHVybiBjcmVhdGVPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcbiAgICAgICAgbG9nZ2VyLmxvZyhcIkJvb3RzdHJhcHBpbmcgXCIgKyBzb2x1dGlvbkxvY2F0aW9uKTtcbiAgICAgICAgZXhpc3RzKGpvaW4oc29sdXRpb25Mb2NhdGlvbiwgXCJvbW5pc2hhcnAuanNvblwiKSlcbiAgICAgICAgICAgIC5maWx0ZXIoeCA9PiAhIXgpXG4gICAgICAgICAgICAuZmxhdE1hcCh4ID0+IHJlYWRGaWxlKGpvaW4oc29sdXRpb25Mb2NhdGlvbiwgXCJvbW5pc2hhcnAuanNvblwiKSkpXG4gICAgICAgICAgICAubWFwKHggPT4gSlNPTi5wYXJzZSh4LnRvU3RyaW5nKCkpKVxuICAgICAgICAgICAgLmRvKHtcbiAgICAgICAgICAgIG5leHQ6IG9iaiA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG9iai5wbHVnaW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhc2hTdHJpbmdzLnB1c2gob2JqLnBsdWdpbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGhhc2ggPSBtZDUoSlNPTi5zdHJpbmdpZnkocGx1Z2lucy5jb25jYXQoaGFzaFN0cmluZ3MpKSk7XG4gICAgICAgICAgICAgICAgaWYgKGJvb3RzdHJhcHBlZFBsdWdpbnMuaGFzKGhhc2gpKSB7XG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoYm9vdHN0cmFwcGVkUGx1Z2lucy5nZXQoaGFzaCkpO1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbW1hbmQgPSBbY3R4LmxvY2F0aW9uLCBcIi1zXCIsIHNvbHV0aW9uTG9jYXRpb25dLmNvbmNhdChwbHVnaW5zLm1hcCh4ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHgubG9jYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgLS1wbHVnaW5zICR7eC5sb2NhdGlvbn1gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHgudmVyc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAtLXBsdWdpbi1uYW1lICR7eC5uYW1lfUAke3gudmVyc2lvbn1gO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAtLXBsdWdpbi1uYW1lICR7eC5uYW1lfWA7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSkuam9pbihcIiBcIik7XG4gICAgICAgICAgICAgICAgZXhlYyhjb21tYW5kLCBmdW5jdGlvbiAoZXJyb3IsIHN0ZG91dCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IHN0ZG91dC50b1N0cmluZygpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChjdHgubG9jYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KVxuICAgICAgICAubWFwKHBhdGggPT4gcGF0aCAmJiBwYXRoIHx8IGN0eC5sb2NhdGlvbilcbiAgICAgICAgLmRvKHJlc3VsdCA9PiB7XG4gICAgICAgIGlmICghYm9vdHN0cmFwcGVkUGx1Z2lucy5oYXMoaGFzaCkpXG4gICAgICAgICAgICBib290c3RyYXBwZWRQbHVnaW5zLnNldChoYXNoLCByZXN1bHQpO1xuICAgICAgICBsb2dnZXIubG9nKFwiRmluaXNoZWQgYm9vdHN0cmFwcGluZyBcIiArIHNvbHV0aW9uTG9jYXRpb24pO1xuICAgIH0pO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
