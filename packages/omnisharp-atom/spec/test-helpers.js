"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.setupFeature = setupFeature;
exports.restoreBuffers = restoreBuffers;
exports.openEditor = openEditor;

var _solutionManager = require("../lib/server/solution-manager");

var _rxjs = require("rxjs");

var _omnisharpClient = require("omnisharp-client");

function setupFeature(features) {
    var unitTestMode = arguments.length <= 1 || arguments[1] === undefined ? true : arguments[1];

    var cd = void 0;
    beforeEach(function () {
        cd = new _omnisharpClient.CompositeDisposable();
        _solutionManager.SolutionManager._unitTestMode_ = unitTestMode;
        _solutionManager.SolutionManager._kick_in_the_pants_ = true;
        atom.config.set("omnisharp-atom:feature-white-list", true);
        atom.config.set("omnisharp-atom:feature-list", features);
        return atom.packages.activatePackage("language-csharp").then(function () {
            return atom.packages.activatePackage("omnisharp-atom");
        }).then(function (pack) {
            return pack.mainModule._activated.delay(200).toPromise();
        });
    });
    afterEach(function () {
        atom.packages.deactivatePackage("omnisharp-atom");
        atom.packages.deactivatePackage("language-csharp");
        atom.config.set("omnisharp-atom:feature-white-list", undefined);
        atom.config.set("omnisharp-atom:feature-list", undefined);
        _solutionManager.SolutionManager._unitTestMode_ = false;
        _solutionManager.SolutionManager._kick_in_the_pants_ = false;
        cd.dispose();
    });
}
function restoreBuffers() {
    return _omnisharpClient.Disposable.empty;
}
function openEditor(file) {
    return _rxjs.Observable.fromPromise(atom.workspace.open(file)).flatMap(function (editor) {
        return _solutionManager.SolutionManager.getSolutionForEditor(editor).map(function (solution) {
            return { editor: editor, solution: solution };
        });
    }).flatMap(function (_ref) {
        var editor = _ref.editor;
        var solution = _ref.solution;
        return solution.state.startWith(solution.currentState).map(function (state) {
            return { editor: editor, solution: solution, state: state };
        });
    }).filter(function (z) {
        return z.state === _omnisharpClient.DriverState.Connected;
    }).take(1).delay(350);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNwZWMvdGVzdC1oZWxwZXJzLnRzIiwic3BlYy90ZXN0LWhlbHBlcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFNQSxZLEdBQUEsWTtRQTBCQSxjLEdBQUEsYztRQTZDQSxVLEdBQUEsVTs7QUM3RUE7O0FBQ0E7O0FBQ0E7O0FESUEsU0FBQSxZQUFBLENBQTZCLFFBQTdCLEVBQW9FO0FBQUEsUUFBbkIsWUFBbUIseURBQUosSUFBSTs7QUFDaEUsUUFBSSxXQUFKO0FBQ0EsZUFBVyxZQUFBO0FBQ1AsYUFBSywwQ0FBTDtBQUNBLHlDQUFnQixjQUFoQixHQUFpQyxZQUFqQztBQUNBLHlDQUFnQixtQkFBaEIsR0FBc0MsSUFBdEM7QUFFQSxhQUFLLE1BQUwsQ0FBWSxHQUFaLENBQWdCLG1DQUFoQixFQUFxRCxJQUFyRDtBQUNBLGFBQUssTUFBTCxDQUFZLEdBQVosQ0FBZ0IsNkJBQWhCLEVBQStDLFFBQS9DO0FBRUEsZUFBTyxLQUFLLFFBQUwsQ0FBYyxlQUFkLENBQThCLGlCQUE5QixFQUNGLElBREUsQ0FDRztBQUFBLG1CQUFNLEtBQUssUUFBTCxDQUFjLGVBQWQsQ0FBOEIsZ0JBQTlCLENBQU47QUFBQSxTQURILEVBRUYsSUFGRSxDQUVHLFVBQUMsSUFBRDtBQUFBLG1CQUF3QixLQUFLLFVBQUwsQ0FBZ0IsVUFBaEIsQ0FBMkIsS0FBM0IsQ0FBaUMsR0FBakMsRUFBc0MsU0FBdEMsRUFBeEI7QUFBQSxTQUZILENBQVA7QUFHSCxLQVhEO0FBYUEsY0FBVSxZQUFBO0FBQ04sYUFBSyxRQUFMLENBQWMsaUJBQWQsQ0FBZ0MsZ0JBQWhDO0FBQ0EsYUFBSyxRQUFMLENBQWMsaUJBQWQsQ0FBZ0MsaUJBQWhDO0FBQ0EsYUFBSyxNQUFMLENBQVksR0FBWixDQUFnQixtQ0FBaEIsRUFBcUQsU0FBckQ7QUFDQSxhQUFLLE1BQUwsQ0FBWSxHQUFaLENBQWdCLDZCQUFoQixFQUErQyxTQUEvQztBQUNBLHlDQUFnQixjQUFoQixHQUFpQyxLQUFqQztBQUNBLHlDQUFnQixtQkFBaEIsR0FBc0MsS0FBdEM7QUFDQSxXQUFHLE9BQUg7QUFDSCxLQVJEO0FBU0g7QUFFRCxTQUFBLGNBQUEsR0FBQTtBQUNJLFdBQU8sNEJBQVcsS0FBbEI7QUEwQ0g7QUFFRCxTQUFBLFVBQUEsQ0FBMkIsSUFBM0IsRUFBdUM7QUFDbkMsV0FBTyxpQkFBVyxXQUFYLENBQTZDLEtBQUssU0FBTCxDQUFlLElBQWYsQ0FBb0IsSUFBcEIsQ0FBN0MsRUFDRixPQURFLENBQ007QUFBQSxlQUNMLGlDQUFnQixvQkFBaEIsQ0FBcUMsTUFBckMsRUFBNkMsR0FBN0MsQ0FBaUQ7QUFBQSxtQkFBYSxFQUFFLGNBQUYsRUFBVSxrQkFBVixFQUFiO0FBQUEsU0FBakQsQ0FESztBQUFBLEtBRE4sRUFJRixPQUpFLENBSU07QUFBQSxZQUFFLE1BQUYsUUFBRSxNQUFGO0FBQUEsWUFBVSxRQUFWLFFBQVUsUUFBVjtBQUFBLGVBQXdCLFNBQVMsS0FBVCxDQUFlLFNBQWYsQ0FBeUIsU0FBUyxZQUFsQyxFQUM1QixHQUQ0QixDQUN4QjtBQUFBLG1CQUFVLEVBQUUsY0FBRixFQUFVLGtCQUFWLEVBQW9CLE9BQU8sS0FBM0IsRUFBVjtBQUFBLFNBRHdCLENBQXhCO0FBQUEsS0FKTixFQU1GLE1BTkUsQ0FNSztBQUFBLGVBQUssRUFBRSxLQUFGLEtBQVksNkJBQVksU0FBN0I7QUFBQSxLQU5MLEVBT0YsSUFQRSxDQU9HLENBUEgsRUFRRixLQVJFLENBUUksR0FSSixDQUFQO0FBU0giLCJmaWxlIjoic3BlYy90ZXN0LWhlbHBlcnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwidHNkLmQudHNcIiAvPlxuaW1wb3J0IHtTb2x1dGlvbk1hbmFnZXJ9IGZyb20gXCIuLi9saWIvc2VydmVyL3NvbHV0aW9uLW1hbmFnZXJcIjtcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgRGlzcG9zYWJsZX0gZnJvbSBcIm9tbmlzaGFycC1jbGllbnRcIjtcbmltcG9ydCB7RHJpdmVyU3RhdGV9IGZyb20gXCJvbW5pc2hhcnAtY2xpZW50XCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXR1cEZlYXR1cmUoZmVhdHVyZXM6IHN0cmluZ1tdLCB1bml0VGVzdE1vZGUgPSB0cnVlKSB7XG4gICAgbGV0IGNkOiBDb21wb3NpdGVEaXNwb3NhYmxlO1xuICAgIGJlZm9yZUVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgIGNkID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcbiAgICAgICAgU29sdXRpb25NYW5hZ2VyLl91bml0VGVzdE1vZGVfID0gdW5pdFRlc3RNb2RlO1xuICAgICAgICBTb2x1dGlvbk1hbmFnZXIuX2tpY2tfaW5fdGhlX3BhbnRzXyA9IHRydWU7XG5cbiAgICAgICAgYXRvbS5jb25maWcuc2V0KFwib21uaXNoYXJwLWF0b206ZmVhdHVyZS13aGl0ZS1saXN0XCIsIHRydWUpO1xuICAgICAgICBhdG9tLmNvbmZpZy5zZXQoXCJvbW5pc2hhcnAtYXRvbTpmZWF0dXJlLWxpc3RcIiwgZmVhdHVyZXMpO1xuXG4gICAgICAgIHJldHVybiBhdG9tLnBhY2thZ2VzLmFjdGl2YXRlUGFja2FnZShcImxhbmd1YWdlLWNzaGFycFwiKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4gYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UoXCJvbW5pc2hhcnAtYXRvbVwiKSlcbiAgICAgICAgICAgIC50aGVuKChwYWNrOiBBdG9tLlBhY2thZ2UpID0+IHBhY2subWFpbk1vZHVsZS5fYWN0aXZhdGVkLmRlbGF5KDIwMCkudG9Qcm9taXNlKCkpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICBhdG9tLnBhY2thZ2VzLmRlYWN0aXZhdGVQYWNrYWdlKFwib21uaXNoYXJwLWF0b21cIik7XG4gICAgICAgIGF0b20ucGFja2FnZXMuZGVhY3RpdmF0ZVBhY2thZ2UoXCJsYW5ndWFnZS1jc2hhcnBcIik7XG4gICAgICAgIGF0b20uY29uZmlnLnNldChcIm9tbmlzaGFycC1hdG9tOmZlYXR1cmUtd2hpdGUtbGlzdFwiLCB1bmRlZmluZWQpO1xuICAgICAgICBhdG9tLmNvbmZpZy5zZXQoXCJvbW5pc2hhcnAtYXRvbTpmZWF0dXJlLWxpc3RcIiwgdW5kZWZpbmVkKTtcbiAgICAgICAgU29sdXRpb25NYW5hZ2VyLl91bml0VGVzdE1vZGVfID0gZmFsc2U7XG4gICAgICAgIFNvbHV0aW9uTWFuYWdlci5fa2lja19pbl90aGVfcGFudHNfID0gZmFsc2U7XG4gICAgICAgIGNkLmRpc3Bvc2UoKTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc3RvcmVCdWZmZXJzKCkge1xuICAgIHJldHVybiBEaXNwb3NhYmxlLmVtcHR5O1xuICAgIC8qXG4gICAgbGV0IGRpc3Bvc2FibGUgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuICAgIGNvbnN0IGJ1ZmZlcnMgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuXG4gICAgaWYgKFNvbHV0aW9uTWFuYWdlci5fdW5pdFRlc3RNb2RlXykge1xuICAgICAgICBkaXNwb3NhYmxlLmFkZChTb2x1dGlvbk1hbmFnZXIuc29sdXRpb25PYnNlcnZlci5yZXNwb25zZXNcbiAgICAgICAgICAgIC5maWx0ZXIoeiA9PlxuICAgICAgICAgICAgICAgIHoucmVxdWVzdC5GaWxlTmFtZSAmJiB6LnJlcXVlc3QuQnVmZmVyKVxuICAgICAgICAgICAgLm1hcCh6ID0+XG4gICAgICAgICAgICAgICAgKHsgZmlsZU5hbWU6IDxzdHJpbmc+ei5yZXF1ZXN0LkZpbGVOYW1lLCBidWZmZXI6IDxzdHJpbmc+ei5yZXF1ZXN0LkJ1ZmZlciB9KSlcbiAgICAgICAgICAgIC5maWx0ZXIoKHtmaWxlTmFtZX0pID0+XG4gICAgICAgICAgICAgICAgIWJ1ZmZlcnMuaGFzKGZpbGVOYW1lKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKHtmaWxlTmFtZSwgYnVmZmVyfSkgPT4ge1xuICAgICAgICAgICAgICAgIGJ1ZmZlcnMuc2V0KGZpbGVOYW1lLCBidWZmZXIpO1xuICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBEaXNwb3NhYmxlLmNyZWF0ZSgoKSA9PiB7XG4gICAgICAgIGRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgICAgICAvLyBSZXNldCB0aGUgYnVmZmVycyB0byB0aGVpciBvcmlnaW5hbCBzdGF0ZVxuICAgICAgICBpZiAoU29sdXRpb25NYW5hZ2VyLl91bml0VGVzdE1vZGVfKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzOiBPYnNlcnZhYmxlPGFueT5bXSA9IFtdO1xuICAgICAgICAgICAgY29uc3QgaXRlcmF0b3IgPSBidWZmZXJzLmVudHJpZXMoKTtcbiAgICAgICAgICAgIGNvbnN0IGl0ZXJhdGVlID0gaXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgd2hpbGUgKCFpdGVyYXRlZS5kb25lKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3BhdGgsIGJ1ZmZlcl0gPSBpdGVyYXRlZS52YWx1ZTtcblxuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChcbiAgICAgICAgICAgICAgICAgICAgU29sdXRpb25NYW5hZ2VyLmdldFNvbHV0aW9uRm9yUGF0aChwYXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCh6ID0+IHoudXBkYXRlYnVmZmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaW5lOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbHVtbjogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCdWZmZXI6IGJ1ZmZlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlTmFtZTogcGF0aFxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGl0ZXJhdGVlID0gaXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7Ki9cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG9wZW5FZGl0b3IoZmlsZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuZnJvbVByb21pc2U8QXRvbS5UZXh0RWRpdG9yPig8YW55PmF0b20ud29ya3NwYWNlLm9wZW4oZmlsZSkpXG4gICAgICAgIC5mbGF0TWFwKGVkaXRvciA9PlxuICAgICAgICAgICAgU29sdXRpb25NYW5hZ2VyLmdldFNvbHV0aW9uRm9yRWRpdG9yKGVkaXRvcikubWFwKHNvbHV0aW9uID0+ICh7IGVkaXRvciwgc29sdXRpb24gfSkpXG4gICAgICAgIClcbiAgICAgICAgLmZsYXRNYXAoKHtlZGl0b3IsIHNvbHV0aW9ufSkgPT4gc29sdXRpb24uc3RhdGUuc3RhcnRXaXRoKHNvbHV0aW9uLmN1cnJlbnRTdGF0ZSlcbiAgICAgICAgICAgIC5tYXAoc3RhdGUgPT4gKHsgZWRpdG9yLCBzb2x1dGlvbiwgc3RhdGU6IHN0YXRlIH0pKSlcbiAgICAgICAgLmZpbHRlcih6ID0+IHouc3RhdGUgPT09IERyaXZlclN0YXRlLkNvbm5lY3RlZClcbiAgICAgICAgLnRha2UoMSlcbiAgICAgICAgLmRlbGF5KDM1MCk7XG59XG4iLCJpbXBvcnQgeyBTb2x1dGlvbk1hbmFnZXIgfSBmcm9tIFwiLi4vbGliL3NlcnZlci9zb2x1dGlvbi1tYW5hZ2VyXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcbmltcG9ydCB7IENvbXBvc2l0ZURpc3Bvc2FibGUsIERpc3Bvc2FibGUgfSBmcm9tIFwib21uaXNoYXJwLWNsaWVudFwiO1xuaW1wb3J0IHsgRHJpdmVyU3RhdGUgfSBmcm9tIFwib21uaXNoYXJwLWNsaWVudFwiO1xuZXhwb3J0IGZ1bmN0aW9uIHNldHVwRmVhdHVyZShmZWF0dXJlcywgdW5pdFRlc3RNb2RlID0gdHJ1ZSkge1xuICAgIGxldCBjZDtcbiAgICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2QgPSBuZXcgQ29tcG9zaXRlRGlzcG9zYWJsZSgpO1xuICAgICAgICBTb2x1dGlvbk1hbmFnZXIuX3VuaXRUZXN0TW9kZV8gPSB1bml0VGVzdE1vZGU7XG4gICAgICAgIFNvbHV0aW9uTWFuYWdlci5fa2lja19pbl90aGVfcGFudHNfID0gdHJ1ZTtcbiAgICAgICAgYXRvbS5jb25maWcuc2V0KFwib21uaXNoYXJwLWF0b206ZmVhdHVyZS13aGl0ZS1saXN0XCIsIHRydWUpO1xuICAgICAgICBhdG9tLmNvbmZpZy5zZXQoXCJvbW5pc2hhcnAtYXRvbTpmZWF0dXJlLWxpc3RcIiwgZmVhdHVyZXMpO1xuICAgICAgICByZXR1cm4gYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UoXCJsYW5ndWFnZS1jc2hhcnBcIilcbiAgICAgICAgICAgIC50aGVuKCgpID0+IGF0b20ucGFja2FnZXMuYWN0aXZhdGVQYWNrYWdlKFwib21uaXNoYXJwLWF0b21cIikpXG4gICAgICAgICAgICAudGhlbigocGFjaykgPT4gcGFjay5tYWluTW9kdWxlLl9hY3RpdmF0ZWQuZGVsYXkoMjAwKS50b1Byb21pc2UoKSk7XG4gICAgfSk7XG4gICAgYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYXRvbS5wYWNrYWdlcy5kZWFjdGl2YXRlUGFja2FnZShcIm9tbmlzaGFycC1hdG9tXCIpO1xuICAgICAgICBhdG9tLnBhY2thZ2VzLmRlYWN0aXZhdGVQYWNrYWdlKFwibGFuZ3VhZ2UtY3NoYXJwXCIpO1xuICAgICAgICBhdG9tLmNvbmZpZy5zZXQoXCJvbW5pc2hhcnAtYXRvbTpmZWF0dXJlLXdoaXRlLWxpc3RcIiwgdW5kZWZpbmVkKTtcbiAgICAgICAgYXRvbS5jb25maWcuc2V0KFwib21uaXNoYXJwLWF0b206ZmVhdHVyZS1saXN0XCIsIHVuZGVmaW5lZCk7XG4gICAgICAgIFNvbHV0aW9uTWFuYWdlci5fdW5pdFRlc3RNb2RlXyA9IGZhbHNlO1xuICAgICAgICBTb2x1dGlvbk1hbmFnZXIuX2tpY2tfaW5fdGhlX3BhbnRzXyA9IGZhbHNlO1xuICAgICAgICBjZC5kaXNwb3NlKCk7XG4gICAgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gcmVzdG9yZUJ1ZmZlcnMoKSB7XG4gICAgcmV0dXJuIERpc3Bvc2FibGUuZW1wdHk7XG59XG5leHBvcnQgZnVuY3Rpb24gb3BlbkVkaXRvcihmaWxlKSB7XG4gICAgcmV0dXJuIE9ic2VydmFibGUuZnJvbVByb21pc2UoYXRvbS53b3Jrc3BhY2Uub3BlbihmaWxlKSlcbiAgICAgICAgLmZsYXRNYXAoZWRpdG9yID0+IFNvbHV0aW9uTWFuYWdlci5nZXRTb2x1dGlvbkZvckVkaXRvcihlZGl0b3IpLm1hcChzb2x1dGlvbiA9PiAoeyBlZGl0b3IsIHNvbHV0aW9uIH0pKSlcbiAgICAgICAgLmZsYXRNYXAoKHsgZWRpdG9yLCBzb2x1dGlvbiB9KSA9PiBzb2x1dGlvbi5zdGF0ZS5zdGFydFdpdGgoc29sdXRpb24uY3VycmVudFN0YXRlKVxuICAgICAgICAubWFwKHN0YXRlID0+ICh7IGVkaXRvciwgc29sdXRpb24sIHN0YXRlOiBzdGF0ZSB9KSkpXG4gICAgICAgIC5maWx0ZXIoeiA9PiB6LnN0YXRlID09PSBEcml2ZXJTdGF0ZS5Db25uZWN0ZWQpXG4gICAgICAgIC50YWtlKDEpXG4gICAgICAgIC5kZWxheSgzNTApO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
